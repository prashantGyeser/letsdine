/*! elastic.js - v1.1.1 - 2013-08-14
 * https://github.com/fullscale/elastic.js
 * Copyright (c) 2013 FullScale Labs, LLC; Licensed MIT */
(function(){"use strict";var has,each,extend,indexOf,genClientParams,genParamStr,isArray,isObject,isString,isNumber,isFunction,isEJSObject,isQuery,isRescore,isFilter,isFacet,isScriptField,isGeoPoint,isIndexedShape,isShape,isSort,isHighlight,isSuggest,isGenerator,isClusterHealth,isClusterState,isNodeStats,isNodeInfo,isRequest,isMultiSearchRequest,ejs,root=this,_ejs=root&&root.ejs,ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProp=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeIsArray=Array.isArray,nativeIndexOf=ArrayProto.indexOf,breaker={};ejs="undefined"!=typeof exports?exports:root.ejs={},has=function(obj,key){return hasOwnProp.call(obj,key)},each=function(obj,iterator,context){if(null!=obj)if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(has(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return},extend=function(obj){return each(slice.call(arguments,1),function(source){for(var prop in source)obj[prop]=source[prop]}),obj},indexOf=function(array,item){if(null==array)return-1;var i=0,l=array.length;if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(;l>i;i++)if(array[i]===item)return i;return-1},genClientParams=function(params,excludes){var param,paramVal,clientParams={};for(param in params)has(params,param)&&-1===indexOf(excludes,param)&&(paramVal=params[param],isArray(paramVal)&&(paramVal=paramVal.join()),clientParams[param]=paramVal);return clientParams},genParamStr=function(params,excludes){var p,clientParams=genClientParams(params,excludes),parts=[];for(p in clientParams)has(clientParams,p)&&parts.push(p+"="+encodeURIComponent(clientParams[p]));return parts.join("&")},isArray=nativeIsArray||function(obj){return"[object Array]"===toString.call(obj)},isObject=function(obj){return obj===Object(obj)},isString=function(obj){return"[object String]"===toString.call(obj)},isNumber=function(obj){return"[object Number]"===toString.call(obj)},isFunction=function(obj){return"function"==typeof obj},isEJSObject=function(obj){return isObject(obj)&&has(obj,"_type")&&has(obj,"_self")&&has(obj,"toString")},isQuery=function(obj){return isEJSObject(obj)&&"query"===obj._type()},isRescore=function(obj){return isEJSObject(obj)&&"rescore"===obj._type()},isFilter=function(obj){return isEJSObject(obj)&&"filter"===obj._type()},isFacet=function(obj){return isEJSObject(obj)&&"facet"===obj._type()},isScriptField=function(obj){return isEJSObject(obj)&&"script field"===obj._type()},isGeoPoint=function(obj){return isEJSObject(obj)&&"geo point"===obj._type()},isIndexedShape=function(obj){return isEJSObject(obj)&&"indexed shape"===obj._type()},isShape=function(obj){return isEJSObject(obj)&&"shape"===obj._type()},isSort=function(obj){return isEJSObject(obj)&&"sort"===obj._type()},isHighlight=function(obj){return isEJSObject(obj)&&"highlight"===obj._type()},isSuggest=function(obj){return isEJSObject(obj)&&"suggest"===obj._type()},isGenerator=function(obj){return isEJSObject(obj)&&"generator"===obj._type()},isClusterHealth=function(obj){return isEJSObject(obj)&&"cluster health"===obj._type()},isClusterState=function(obj){return isEJSObject(obj)&&"cluster state"===obj._type()},isNodeStats=function(obj){return isEJSObject(obj)&&"node stats"===obj._type()},isNodeInfo=function(obj){return isEJSObject(obj)&&"node info"===obj._type()},isRequest=function(obj){return isEJSObject(obj)&&"request"===obj._type()},isMultiSearchRequest=function(obj){return isEJSObject(obj)&&"multi search request"===obj._type()},ejs.DateHistogramFacet=function(name){var facet={};return facet[name]={date_histogram:{}},{field:function(fieldName){return null==fieldName?facet[name].date_histogram.field:(facet[name].date_histogram.field=fieldName,this)},keyField:function(fieldName){return null==fieldName?facet[name].date_histogram.key_field:(facet[name].date_histogram.key_field=fieldName,this)},valueField:function(fieldName){return null==fieldName?facet[name].date_histogram.value_field:(facet[name].date_histogram.value_field=fieldName,this)},interval:function(timeInterval){return null==timeInterval?facet[name].date_histogram.interval:(facet[name].date_histogram.interval=timeInterval,this)},timeZone:function(tz){return null==tz?facet[name].date_histogram.time_zone:(facet[name].date_histogram.time_zone=tz,this)},preZone:function(tz){return null==tz?facet[name].date_histogram.pre_zone:(facet[name].date_histogram.pre_zone=tz,this)},preZoneAdjustLargeInterval:function(trueFalse){return null==trueFalse?facet[name].date_histogram.pre_zone_adjust_large_interval:(facet[name].date_histogram.pre_zone_adjust_large_interval=trueFalse,this)},postZone:function(tz){return null==tz?facet[name].date_histogram.post_zone:(facet[name].date_histogram.post_zone=tz,this)},preOffset:function(offset){return null==offset?facet[name].date_histogram.pre_offset:(facet[name].date_histogram.pre_offset=offset,this)},postOffset:function(offset){return null==offset?facet[name].date_histogram.post_offset:(facet[name].date_histogram.post_offset=offset,this)},factor:function(f){return null==f?facet[name].date_histogram.factor:(facet[name].date_histogram.factor=f,this)},valueScript:function(scriptCode){return null==scriptCode?facet[name].date_histogram.value_script:(facet[name].date_histogram.value_script=scriptCode,this)},order:function(o){return null==o?facet[name].date_histogram.order:(o=o.toLowerCase(),("time"===o||"count"===o||"total"===o)&&(facet[name].date_histogram.order=o),this)},lang:function(language){return null==language?facet[name].date_histogram.lang:(facet[name].date_histogram.lang=language,this)},params:function(p){return null==p?facet[name].date_histogram.params:(facet[name].date_histogram.params=p,this)},facetFilter:function(oFilter){if(null==oFilter)return facet[name].facet_filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return facet[name].facet_filter=oFilter._self(),this},global:function(trueFalse){return null==trueFalse?facet[name].global:(facet[name].global=trueFalse,this)},mode:function(m){return null==m?facet[name].mode:(m=m.toLowerCase(),("collector"===m||"post"===m)&&(facet[name].mode=m),this)},scope:function(){return this},cacheFilter:function(trueFalse){return null==trueFalse?facet[name].cache_filter:(facet[name].cache_filter=trueFalse,this)},nested:function(path){return null==path?facet[name].nested:(facet[name].nested=path,this)},toString:function(){return JSON.stringify(facet)},_type:function(){return"facet"},_self:function(){return facet}}},ejs.FilterFacet=function(name){var facet={};return facet[name]={},{filter:function(oFilter){if(null==oFilter)return facet[name].filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return facet[name].filter=oFilter._self(),this},facetFilter:function(oFilter){if(null==oFilter)return facet[name].facet_filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return facet[name].facet_filter=oFilter._self(),this},global:function(trueFalse){return null==trueFalse?facet[name].global:(facet[name].global=trueFalse,this)},mode:function(m){return null==m?facet[name].mode:(m=m.toLowerCase(),("collector"===m||"post"===m)&&(facet[name].mode=m),this)},scope:function(){return this},cacheFilter:function(trueFalse){return null==trueFalse?facet[name].cache_filter:(facet[name].cache_filter=trueFalse,this)},nested:function(path){return null==path?facet[name].nested:(facet[name].nested=path,this)},toString:function(){return JSON.stringify(facet)},_type:function(){return"facet"},_self:function(){return facet}}},ejs.GeoDistanceFacet=function(name){var facet={},point=ejs.GeoPoint([0,0]),field="location";return facet[name]={geo_distance:{location:point._self(),ranges:[]}},{field:function(fieldName){var oldValue=facet[name].geo_distance[field];return null==fieldName?field:(delete facet[name].geo_distance[field],field=fieldName,facet[name].geo_distance[fieldName]=oldValue,this)},point:function(p){if(null==p)return point;if(!isGeoPoint(p))throw new TypeError("Argument must be a GeoPoint");return point=p,facet[name].geo_distance[field]=p._self(),this},addRange:function(from,to){return 0===arguments.length?facet[name].geo_distance.ranges:(facet[name].geo_distance.ranges.push({from:from,to:to}),this)},addUnboundedFrom:function(from){return null==from?facet[name].geo_distance.ranges:(facet[name].geo_distance.ranges.push({from:from}),this)},addUnboundedTo:function(to){return null==to?facet[name].geo_distance.ranges:(facet[name].geo_distance.ranges.push({to:to}),this)},unit:function(unit){return null==unit?facet[name].geo_distance.unit:(unit=unit.toLowerCase(),("mi"===unit||"km"===unit)&&(facet[name].geo_distance.unit=unit),this)},distanceType:function(type){return null==type?facet[name].geo_distance.distance_type:(type=type.toLowerCase(),("arc"===type||"plane"===type)&&(facet[name].geo_distance.distance_type=type),this)},normalize:function(trueFalse){return null==trueFalse?facet[name].geo_distance.normalize:(facet[name].geo_distance.normalize=trueFalse,this)},valueField:function(fieldName){return null==fieldName?facet[name].geo_distance.value_field:(facet[name].geo_distance.value_field=fieldName,this)},valueScript:function(scriptCode){return null==scriptCode?facet[name].geo_distance.value_script:(facet[name].geo_distance.value_script=scriptCode,this)},lang:function(language){return null==language?facet[name].geo_distance.lang:(facet[name].geo_distance.lang=language,this)},params:function(p){return null==p?facet[name].geo_distance.params:(facet[name].geo_distance.params=p,this)},facetFilter:function(oFilter){if(null==oFilter)return facet[name].facet_filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return facet[name].facet_filter=oFilter._self(),this},global:function(trueFalse){return null==trueFalse?facet[name].global:(facet[name].global=trueFalse,this)},mode:function(m){return null==m?facet[name].mode:(m=m.toLowerCase(),("collector"===m||"post"===m)&&(facet[name].mode=m),this)},scope:function(){return this},cacheFilter:function(trueFalse){return null==trueFalse?facet[name].cache_filter:(facet[name].cache_filter=trueFalse,this)},nested:function(path){return null==path?facet[name].nested:(facet[name].nested=path,this)},toString:function(){return JSON.stringify(facet)},_type:function(){return"facet"},_self:function(){return facet}}},ejs.HistogramFacet=function(name){var facet={};return facet[name]={histogram:{}},{field:function(fieldName){return null==fieldName?facet[name].histogram.field:(facet[name].histogram.field=fieldName,this)},interval:function(numericInterval){return null==numericInterval?facet[name].histogram.interval:(facet[name].histogram.interval=numericInterval,this)},timeInterval:function(timeInterval){return null==timeInterval?facet[name].histogram.time_interval:(facet[name].histogram.time_interval=timeInterval,this)},from:function(from){return null==from?facet[name].histogram.from:(facet[name].histogram.from=from,this)},to:function(to){return null==to?facet[name].histogram.to:(facet[name].histogram.to=to,this)},valueField:function(fieldName){return null==fieldName?facet[name].histogram.value_field:(facet[name].histogram.value_field=fieldName,this)},keyField:function(fieldName){return null==fieldName?facet[name].histogram.key_field:(facet[name].histogram.key_field=fieldName,this)},valueScript:function(scriptCode){return null==scriptCode?facet[name].histogram.value_script:(facet[name].histogram.value_script=scriptCode,this)},keyScript:function(scriptCode){return null==scriptCode?facet[name].histogram.key_script:(facet[name].histogram.key_script=scriptCode,this)},lang:function(language){return null==language?facet[name].histogram.lang:(facet[name].histogram.lang=language,this)},params:function(p){return null==p?facet[name].histogram.params:(facet[name].histogram.params=p,this)},order:function(o){return null==o?facet[name].histogram.order:(o=o.toLowerCase(),("key"===o||"count"===o||"total"===o)&&(facet[name].histogram.order=o),this)},facetFilter:function(oFilter){if(null==oFilter)return facet[name].facet_filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return facet[name].facet_filter=oFilter._self(),this},global:function(trueFalse){return null==trueFalse?facet[name].global:(facet[name].global=trueFalse,this)},mode:function(m){return null==m?facet[name].mode:(m=m.toLowerCase(),("collector"===m||"post"===m)&&(facet[name].mode=m),this)},scope:function(){return this},cacheFilter:function(trueFalse){return null==trueFalse?facet[name].cache_filter:(facet[name].cache_filter=trueFalse,this)},nested:function(path){return null==path?facet[name].nested:(facet[name].nested=path,this)},toString:function(){return JSON.stringify(facet)},_type:function(){return"facet"},_self:function(){return facet}}},ejs.QueryFacet=function(name){var facet={};return facet[name]={},{query:function(oQuery){if(null==oQuery)return facet[name].query;if(!isQuery(oQuery))throw new TypeError("Argument must be a Query");return facet[name].query=oQuery._self(),this},facetFilter:function(oFilter){if(null==oFilter)return facet[name].facet_filter;if(!isFilter(oFilter))throw new TypeError("Argumnet must be a Filter");return facet[name].facet_filter=oFilter._self(),this},global:function(trueFalse){return null==trueFalse?facet[name].global:(facet[name].global=trueFalse,this)},mode:function(m){return null==m?facet[name].mode:(m=m.toLowerCase(),("collector"===m||"post"===m)&&(facet[name].mode=m),this)},scope:function(){return this},cacheFilter:function(trueFalse){return null==trueFalse?facet[name].cache_filter:(facet[name].cache_filter=trueFalse,this)},nested:function(path){return null==path?facet[name].nested:(facet[name].nested=path,this)},toString:function(){return JSON.stringify(facet)},_type:function(){return"facet"},_self:function(){return facet}}},ejs.RangeFacet=function(name){var facet={};return facet[name]={range:{ranges:[]}},{field:function(fieldName){return null==fieldName?facet[name].range.field:(facet[name].range.field=fieldName,this)},keyField:function(fieldName){return null==fieldName?facet[name].range.key_field:(facet[name].range.key_field=fieldName,this)},valueField:function(fieldName){return null==fieldName?facet[name].range.value_field:(facet[name].range.value_field=fieldName,this)},valueScript:function(scriptCode){return null==scriptCode?facet[name].range.value_script:(facet[name].range.value_script=scriptCode,this)},keyScript:function(scriptCode){return null==scriptCode?facet[name].range.key_script:(facet[name].range.key_script=scriptCode,this)},lang:function(language){return null==language?facet[name].range.lang:(facet[name].range.lang=language,this)},params:function(p){return null==p?facet[name].range.params:(facet[name].range.params=p,this)},addRange:function(from,to){return 0===arguments.length?facet[name].range.ranges:(facet[name].range.ranges.push({from:from,to:to}),this)},addUnboundedFrom:function(from){return null==from?facet[name].range.ranges:(facet[name].range.ranges.push({from:from}),this)},addUnboundedTo:function(to){return null==to?facet[name].range.ranges:(facet[name].range.ranges.push({to:to}),this)},facetFilter:function(oFilter){if(null==oFilter)return facet[name].facet_filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return facet[name].facet_filter=oFilter._self(),this},global:function(trueFalse){return null==trueFalse?facet[name].global:(facet[name].global=trueFalse,this)},mode:function(m){return null==m?facet[name].mode:(m=m.toLowerCase(),("collector"===m||"post"===m)&&(facet[name].mode=m),this)},scope:function(){return this},cacheFilter:function(trueFalse){return null==trueFalse?facet[name].cache_filter:(facet[name].cache_filter=trueFalse,this)},nested:function(path){return null==path?facet[name].nested:(facet[name].nested=path,this)},toString:function(){return JSON.stringify(facet)},_type:function(){return"facet"},_self:function(){return facet}}},ejs.StatisticalFacet=function(name){var facet={};return facet[name]={statistical:{}},{field:function(fieldName){return null==fieldName?facet[name].statistical.field:(facet[name].statistical.field=fieldName,this)},fields:function(fields){if(null==fields)return facet[name].statistical.fields;if(!isArray(fields))throw new TypeError("Argument must be an array");return facet[name].statistical.fields=fields,this},script:function(code){return null==code?facet[name].statistical.script:(facet[name].statistical.script=code,this)},lang:function(language){return null==language?facet[name].statistical.lang:(facet[name].statistical.lang=language,this)},params:function(oParams){return null==oParams?facet[name].statistical.params:(facet[name].statistical.params=oParams,this)},facetFilter:function(oFilter){if(null==oFilter)return facet[name].facet_filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return facet[name].facet_filter=oFilter._self(),this},global:function(trueFalse){return null==trueFalse?facet[name].global:(facet[name].global=trueFalse,this)},mode:function(m){return null==m?facet[name].mode:(m=m.toLowerCase(),("collector"===m||"post"===m)&&(facet[name].mode=m),this)},scope:function(){return this},cacheFilter:function(trueFalse){return null==trueFalse?facet[name].cache_filter:(facet[name].cache_filter=trueFalse,this)},nested:function(path){return null==path?facet[name].nested:(facet[name].nested=path,this)},toString:function(){return JSON.stringify(facet)},_type:function(){return"facet"},_self:function(){return facet}}},ejs.TermStatsFacet=function(name){var facet={};return facet[name]={terms_stats:{}},{valueField:function(fieldName){return null==fieldName?facet[name].terms_stats.value_field:(facet[name].terms_stats.value_field=fieldName,this)},keyField:function(fieldName){return null==fieldName?facet[name].terms_stats.key_field:(facet[name].terms_stats.key_field=fieldName,this)},scriptField:function(script){return null==script?facet[name].terms_stats.script_field:(facet[name].terms_stats.script_field=script,this)},valueScript:function(code){return null==code?facet[name].terms_stats.value_script:(facet[name].terms_stats.value_script=code,this)},allTerms:function(trueFalse){return null==trueFalse?facet[name].terms_stats.all_terms:(facet[name].terms_stats.all_terms=trueFalse,this)},lang:function(language){return null==language?facet[name].terms_stats.lang:(facet[name].terms_stats.lang=language,this)},params:function(oParams){return null==oParams?facet[name].terms_stats.params:(facet[name].terms_stats.params=oParams,this)},size:function(facetSize){return null==facetSize?facet[name].terms_stats.size:(facet[name].terms_stats.size=facetSize,this)},order:function(o){return null==o?facet[name].terms_stats.order:(o=o.toLowerCase(),("count"===o||"term"===o||"reverse_count"===o||"reverse_term"===o||"total"===o||"reverse_total"===o||"min"===o||"reverse_min"===o||"max"===o||"reverse_max"===o||"mean"===o||"reverse_mean"===o)&&(facet[name].terms_stats.order=o),this)},facetFilter:function(oFilter){if(null==oFilter)return facet[name].facet_filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return facet[name].facet_filter=oFilter._self(),this},global:function(trueFalse){return null==trueFalse?facet[name].global:(facet[name].global=trueFalse,this)},mode:function(m){return null==m?facet[name].mode:(m=m.toLowerCase(),("collector"===m||"post"===m)&&(facet[name].mode=m),this)},scope:function(){return this},cacheFilter:function(trueFalse){return null==trueFalse?facet[name].cache_filter:(facet[name].cache_filter=trueFalse,this)},nested:function(path){return null==path?facet[name].nested:(facet[name].nested=path,this)},toString:function(){return JSON.stringify(facet)},_type:function(){return"facet"},_self:function(){return facet}}},ejs.TermsFacet=function(name){var facet={};return facet[name]={terms:{}},{field:function(fieldName){return null==fieldName?facet[name].terms.field:(facet[name].terms.field=fieldName,this)},fields:function(fields){if(null==fields)return facet[name].terms.fields;if(!isArray(fields))throw new TypeError("Argument must be an array");return facet[name].terms.fields=fields,this},scriptField:function(script){return null==script?facet[name].terms.script_field:(facet[name].terms.script_field=script,this)},size:function(facetSize){return null==facetSize?facet[name].terms.size:(facet[name].terms.size=facetSize,this)},order:function(o){return null==o?facet[name].terms.order:(o=o.toLowerCase(),("count"===o||"term"===o||"reverse_count"===o||"reverse_term"===o)&&(facet[name].terms.order=o),this)},allTerms:function(trueFalse){return null==trueFalse?facet[name].terms.all_terms:(facet[name].terms.all_terms=trueFalse,this)},exclude:function(exclude){if(null==facet[name].terms.exclude&&(facet[name].terms.exclude=[]),null==exclude)return facet[name].terms.exclude;if(isString(exclude))facet[name].terms.exclude.push(exclude);else{if(!isArray(exclude))throw new TypeError("Argument must be string or array");facet[name].terms.exclude=exclude}return this},regex:function(exp){return null==exp?facet[name].terms.regex:(facet[name].terms.regex=exp,this)},regexFlags:function(flags){return null==flags?facet[name].terms.regex_flags:(facet[name].terms.regex_flags=flags,this)},script:function(scriptCode){return null==scriptCode?facet[name].terms.script:(facet[name].terms.script=scriptCode,this)},lang:function(language){return null==language?facet[name].terms.lang:(facet[name].terms.lang=language,this)},params:function(p){return null==p?facet[name].terms.params:(facet[name].terms.params=p,this)},executionHint:function(h){return null==h?facet[name].terms.execution_hint:(facet[name].terms.execution_hint=h,this)},facetFilter:function(oFilter){if(null==oFilter)return facet[name].facet_filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return facet[name].facet_filter=oFilter._self(),this},global:function(trueFalse){return null==trueFalse?facet[name].global:(facet[name].global=trueFalse,this)},mode:function(m){return null==m?facet[name].mode:(m=m.toLowerCase(),("collector"===m||"post"===m)&&(facet[name].mode=m),this)},scope:function(){return this},cacheFilter:function(trueFalse){return null==trueFalse?facet[name].cache_filter:(facet[name].cache_filter=trueFalse,this)},nested:function(path){return null==path?facet[name].nested:(facet[name].nested=path,this)},toString:function(){return JSON.stringify(facet)},_type:function(){return"facet"},_self:function(){return facet}}},ejs.AndFilter=function(f){var i,len,filter={and:{filters:[]}};if(isFilter(f))filter.and.filters.push(f._self());else{if(!isArray(f))throw new TypeError("Argument must be a Filter or Array of Filters");for(i=0,len=f.length;len>i;i++){if(!isFilter(f[i]))throw new TypeError("Array must contain only Filter objects");filter.and.filters.push(f[i]._self())}}return{filters:function(fltr){var i,len;if(null==fltr)return filter.and.filters;if(isFilter(fltr))filter.and.filters.push(fltr._self());else{if(!isArray(fltr))throw new TypeError("Argument must be a Filter or an Array of Filters");for(filter.and.filters=[],i=0,len=fltr.length;len>i;i++){if(!isFilter(fltr[i]))throw new TypeError("Array must contain only Filter objects");filter.and.filters.push(fltr[i]._self())}}return this},name:function(name){return null==name?filter.and._name:(filter.and._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.and._cache:(filter.and._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.and._cache_key:(filter.and._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.BoolFilter=function(){var filter={bool:{}};return{must:function(oFilter){var i,len;if(null==filter.bool.must&&(filter.bool.must=[]),null==oFilter)return filter.bool.must;if(isFilter(oFilter))filter.bool.must.push(oFilter._self());else{if(!isArray(oFilter))throw new TypeError("Argument must be a Filter or array of Filters");for(filter.bool.must=[],i=0,len=oFilter.length;len>i;i++){if(!isFilter(oFilter[i]))throw new TypeError("Argument must be an array of Filters");filter.bool.must.push(oFilter[i]._self())}}return this},mustNot:function(oFilter){var i,len;if(null==filter.bool.must_not&&(filter.bool.must_not=[]),null==oFilter)return filter.bool.must_not;if(isFilter(oFilter))filter.bool.must_not.push(oFilter._self());else{if(!isArray(oFilter))throw new TypeError("Argument must be a Filter or array of Filters");for(filter.bool.must_not=[],i=0,len=oFilter.length;len>i;i++){if(!isFilter(oFilter[i]))throw new TypeError("Argument must be an array of Filters");filter.bool.must_not.push(oFilter[i]._self())}}return this},should:function(oFilter){var i,len;if(null==filter.bool.should&&(filter.bool.should=[]),null==oFilter)return filter.bool.should;if(isFilter(oFilter))filter.bool.should.push(oFilter._self());else{if(!isArray(oFilter))throw new TypeError("Argument must be a Filter or array of Filters");for(filter.bool.should=[],i=0,len=oFilter.length;len>i;i++){if(!isFilter(oFilter[i]))throw new TypeError("Argument must be an array of Filters");filter.bool.should.push(oFilter[i]._self())}}return this},name:function(name){return null==name?filter.bool._name:(filter.bool._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.bool._cache:(filter.bool._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.bool._cache_key:(filter.bool._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.ExistsFilter=function(fieldName){var filter={exists:{field:fieldName}};return{field:function(name){return null==name?filter.exists.field:(filter.exists.field=name,this)},name:function(name){return null==name?filter.exists._name:(filter.exists._name=name,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.GeoBboxFilter=function(fieldName){var filter={geo_bounding_box:{}};return filter.geo_bounding_box[fieldName]={},{field:function(f){var oldValue=filter.geo_bounding_box[fieldName];return null==f?fieldName:(delete filter.geo_bounding_box[fieldName],fieldName=f,filter.geo_bounding_box[f]=oldValue,this)},topLeft:function(p){if(null==p)return filter.geo_bounding_box[fieldName].top_left;if(!isGeoPoint(p))throw new TypeError("Argument must be a GeoPoint");return filter.geo_bounding_box[fieldName].top_left=p._self(),this},bottomRight:function(p){if(null==p)return filter.geo_bounding_box[fieldName].bottom_right;if(!isGeoPoint(p))throw new TypeError("Argument must be a GeoPoint");return filter.geo_bounding_box[fieldName].bottom_right=p._self(),this},type:function(type){return null==type?filter.geo_bounding_box.type:(type=type.toLowerCase(),("memory"===type||"indexed"===type)&&(filter.geo_bounding_box.type=type),this)},normalize:function(trueFalse){return null==trueFalse?filter.geo_bounding_box.normalize:(filter.geo_bounding_box.normalize=trueFalse,this)},name:function(name){return null==name?filter.geo_bounding_box._name:(filter.geo_bounding_box._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.geo_bounding_box._cache:(filter.geo_bounding_box._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.geo_bounding_box._cache_key:(filter.geo_bounding_box._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.GeoDistanceFilter=function(fieldName){var filter={geo_distance:{}};return filter.geo_distance[fieldName]=[0,0],{field:function(f){var oldValue=filter.geo_distance[fieldName];return null==f?fieldName:(delete filter.geo_distance[fieldName],fieldName=f,filter.geo_distance[f]=oldValue,this)},distance:function(numericDistance){if(null==numericDistance)return filter.geo_distance.distance;if(!isNumber(numericDistance))throw new TypeError("Argument must be a numeric value");return filter.geo_distance.distance=numericDistance,this},unit:function(unit){return null==unit?filter.geo_distance.unit:(unit=unit.toLowerCase(),("mi"===unit||"km"===unit)&&(filter.geo_distance.unit=unit),this)},point:function(p){if(null==p)return filter.geo_distance[fieldName];if(!isGeoPoint(p))throw new TypeError("Argument must be a GeoPoint");return filter.geo_distance[fieldName]=p._self(),this},distanceType:function(type){return null==type?filter.geo_distance.distance_type:(type=type.toLowerCase(),("arc"===type||"plane"===type)&&(filter.geo_distance.distance_type=type),this)},normalize:function(trueFalse){return null==trueFalse?filter.geo_distance.normalize:(filter.geo_distance.normalize=trueFalse,this)},optimizeBbox:function(t){return null==t?filter.geo_distance.optimize_bbox:(t=t.toLowerCase(),("memory"===t||"indexed"===t||"none"===t)&&(filter.geo_distance.optimize_bbox=t),this)},name:function(name){return null==name?filter.geo_distance._name:(filter.geo_distance._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.geo_distance._cache:(filter.geo_distance._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.geo_distance._cache_key:(filter.geo_distance._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.GeoDistanceRangeFilter=function(fieldName){var filter={geo_distance_range:{}};return filter.geo_distance_range[fieldName]=[0,0],{field:function(f){var oldValue=filter.geo_distance_range[fieldName];return null==f?fieldName:(delete filter.geo_distance_range[fieldName],fieldName=f,filter.geo_distance_range[f]=oldValue,this)},from:function(numericDistance){if(null==numericDistance)return filter.geo_distance_range.from;if(!isNumber(numericDistance))throw new TypeError("Argument must be a numeric value");return filter.geo_distance_range.from=numericDistance,this},to:function(numericDistance){if(null==numericDistance)return filter.geo_distance_range.to;if(!isNumber(numericDistance))throw new TypeError("Argument must be a numeric value");return filter.geo_distance_range.to=numericDistance,this},includeLower:function(trueFalse){return null==trueFalse?filter.geo_distance_range.include_lower:(filter.geo_distance_range.include_lower=trueFalse,this)},includeUpper:function(trueFalse){return null==trueFalse?filter.geo_distance_range.include_upper:(filter.geo_distance_range.include_upper=trueFalse,this)},gt:function(val){if(null==val)return filter.geo_distance_range.gt;if(!isNumber(val))throw new TypeError("Argument must be a numeric value");return filter.geo_distance_range.gt=val,this},gte:function(val){if(null==val)return filter.geo_distance_range.gte;if(!isNumber(val))throw new TypeError("Argument must be a numeric value");return filter.geo_distance_range.gte=val,this},lt:function(val){if(null==val)return filter.geo_distance_range.lt;if(!isNumber(val))throw new TypeError("Argument must be a numeric value");return filter.geo_distance_range.lt=val,this},lte:function(val){if(null==val)return filter.geo_distance_range.lte;if(!isNumber(val))throw new TypeError("Argument must be a numeric value");return filter.geo_distance_range.lte=val,this},unit:function(unit){return null==unit?filter.geo_distance_range.unit:(unit=unit.toLowerCase(),("mi"===unit||"km"===unit)&&(filter.geo_distance_range.unit=unit),this)},point:function(p){if(null==p)return filter.geo_distance_range[fieldName];if(!isGeoPoint(p))throw new TypeError("Argument must be a GeoPoint");return filter.geo_distance_range[fieldName]=p._self(),this},distanceType:function(type){return null==type?filter.geo_distance_range.distance_type:(type=type.toLowerCase(),("arc"===type||"plane"===type)&&(filter.geo_distance_range.distance_type=type),this)},normalize:function(trueFalse){return null==trueFalse?filter.geo_distance_range.normalize:(filter.geo_distance_range.normalize=trueFalse,this)},optimizeBbox:function(t){return null==t?filter.geo_distance_range.optimize_bbox:(t=t.toLowerCase(),("memory"===t||"indexed"===t||"none"===t)&&(filter.geo_distance_range.optimize_bbox=t),this)},name:function(name){return null==name?filter.geo_distance_range._name:(filter.geo_distance_range._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.geo_distance_range._cache:(filter.geo_distance_range._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.geo_distance_range._cache_key:(filter.geo_distance_range._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter
}}},ejs.GeoPolygonFilter=function(fieldName){var filter={geo_polygon:{}};return filter.geo_polygon[fieldName]={points:[]},{field:function(f){var oldValue=filter.geo_polygon[fieldName];return null==f?fieldName:(delete filter.geo_polygon[fieldName],fieldName=f,filter.geo_polygon[f]=oldValue,this)},points:function(p){var i,len;if(null==p)return filter.geo_polygon[fieldName].points;if(isGeoPoint(p))filter.geo_polygon[fieldName].points.push(p._self());else{if(!isArray(p))throw new TypeError("Argument must be a GeoPoint or Array of GeoPoints");for(filter.geo_polygon[fieldName].points=[],i=0,len=p.length;len>i;i++){if(!isGeoPoint(p[i]))throw new TypeError("Argument must be Array of GeoPoints");filter.geo_polygon[fieldName].points.push(p[i]._self())}}return this},normalize:function(trueFalse){return null==trueFalse?filter.geo_polygon.normalize:(filter.geo_polygon.normalize=trueFalse,this)},name:function(name){return null==name?filter.geo_polygon._name:(filter.geo_polygon._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.geo_polygon._cache:(filter.geo_polygon._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.geo_polygon._cache_key:(filter.geo_polygon._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.GeoShapeFilter=function(field){var filter={geo_shape:{}};return filter.geo_shape[field]={},{field:function(f){var oldValue=filter.geo_shape[field];return null==f?field:(delete filter.geo_shape[field],field=f,filter.geo_shape[f]=oldValue,this)},shape:function(shape){return null==shape?filter.geo_shape[field].shape:(null!=filter.geo_shape[field].indexed_shape&&delete filter.geo_shape[field].indexed_shape,filter.geo_shape[field].shape=shape._self(),this)},indexedShape:function(indexedShape){return null==indexedShape?filter.geo_shape[field].indexed_shape:(null!=filter.geo_shape[field].shape&&delete filter.geo_shape[field].shape,filter.geo_shape[field].indexed_shape=indexedShape._self(),this)},relation:function(relation){return null==relation?filter.geo_shape[field].relation:(relation=relation.toLowerCase(),("intersects"===relation||"disjoint"===relation||"within"===relation)&&(filter.geo_shape[field].relation=relation),this)},strategy:function(strategy){return null==strategy?filter.geo_shape[field].strategy:(strategy=strategy.toLowerCase(),("recursive"===strategy||"term"===strategy)&&(filter.geo_shape[field].strategy=strategy),this)},name:function(name){return null==name?filter.geo_shape._name:(filter.geo_shape._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.geo_shape._cache:(filter.geo_shape._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.geo_shape._cache_key:(filter.geo_shape._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.HasChildFilter=function(qry,type){if(!isQuery(qry))throw new TypeError("No Query object found");var filter={has_child:{query:qry._self(),type:type}};return{query:function(q){if(null==q)return filter.has_child.query;if(!isQuery(q))throw new TypeError("Argument must be a Query object");return filter.has_child.query=q._self(),this},filter:function(f){if(null==f)return filter.has_child.filter;if(!isFilter(f))throw new TypeError("Argument must be a Filter object");return filter.has_child.filter=f._self(),this},type:function(t){return null==t?filter.has_child.type:(filter.has_child.type=t,this)},shortCircuitCutoff:function(cutoff){return null==cutoff?filter.has_child.short_circuit_cutoff:(filter.has_child.short_circuit_cutoff=cutoff,this)},scope:function(){return this},name:function(name){return null==name?filter.has_child._name:(filter.has_child._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.has_child._cache:(filter.has_child._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.has_child._cache_key:(filter.has_child._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.HasParentFilter=function(qry,parentType){if(!isQuery(qry))throw new TypeError("No Query object found");var filter={has_parent:{query:qry._self(),parent_type:parentType}};return{query:function(q){if(null==q)return filter.has_parent.query;if(!isQuery(q))throw new TypeError("Argument must be a Query object");return filter.has_parent.query=q._self(),this},filter:function(f){if(null==f)return filter.has_parent.filter;if(!isFilter(f))throw new TypeError("Argument must be a Filter object");return filter.has_parent.filter=f._self(),this},parentType:function(t){return null==t?filter.has_parent.parent_type:(filter.has_parent.parent_type=t,this)},scope:function(){return this},name:function(name){return null==name?filter.has_parent._name:(filter.has_parent._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.has_parent._cache:(filter.has_parent._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.has_parent._cache_key:(filter.has_parent._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.IdsFilter=function(ids){var filter={ids:{}};if(isString(ids))filter.ids.values=[ids];else{if(!isArray(ids))throw new TypeError("Argument must be a string or an array");filter.ids.values=ids}return{values:function(val){if(null==val)return filter.ids.values;if(isString(val))filter.ids.values.push(val);else{if(!isArray(val))throw new TypeError("Argument must be a string or an array");filter.ids.values=val}return this},type:function(type){if(null==filter.ids.type&&(filter.ids.type=[]),null==type)return filter.ids.type;if(isString(type))filter.ids.type.push(type);else{if(!isArray(type))throw new TypeError("Argument must be a string or an array");filter.ids.type=type}return this},name:function(name){return null==name?filter.ids._name:(filter.ids._name=name,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.IndicesFilter=function(fltr,indices){if(!isFilter(fltr))throw new TypeError("Argument must be a Filter");var filter={indices:{filter:fltr._self()}};if(isString(indices))filter.indices.indices=[indices];else{if(!isArray(indices))throw new TypeError("Argument must be a string or array");filter.indices.indices=indices}return{indices:function(i){if(null==i)return filter.indices.indices;if(isString(i))filter.indices.indices.push(i);else{if(!isArray(i))throw new TypeError("Argument must be a string or array");filter.indices.indices=i}return this},filter:function(f){if(null==f)return filter.indices.filter;if(!isFilter(f))throw new TypeError("Argument must be a Filter");return filter.indices.filter=f._self(),this},noMatchFilter:function(f){if(null==f)return filter.indices.no_match_filter;if(isString(f))f=f.toLowerCase(),("none"===f||"all"===f)&&(filter.indices.no_match_filter=f);else{if(!isFilter(f))throw new TypeError("Argument must be string or Filter");filter.indices.no_match_filter=f._self()}return this},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.LimitFilter=function(limit){var filter={limit:{value:limit}};return{value:function(val){if(null==val)return filter.limit.value;if(!isNumber(val))throw new TypeError("Argument must be a numeric value");return filter.limit.value=val,this},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.MatchAllFilter=function(){var filter={match_all:{}};return{toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.MissingFilter=function(fieldName){var filter={missing:{field:fieldName}};return{field:function(name){return null==name?filter.missing.field:(filter.missing.field=name,this)},existence:function(trueFalse){return null==trueFalse?filter.missing.existence:(filter.missing.existence=trueFalse,this)},nullValue:function(trueFalse){return null==trueFalse?filter.missing.null_value:(filter.missing.null_value=trueFalse,this)},name:function(name){return null==name?filter.missing._name:(filter.missing._name=name,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.NestedFilter=function(path){var filter={nested:{path:path}};return{path:function(p){return null==p?filter.nested.path:(filter.nested.path=p,this)},query:function(oQuery){if(null==oQuery)return filter.nested.query;if(!isQuery(oQuery))throw new TypeError("Argument must be a Query object");return filter.nested.query=oQuery._self(),this},filter:function(oFilter){if(null==oFilter)return filter.nested.filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter object");return filter.nested.filter=oFilter._self(),this},boost:function(boost){return null==boost?filter.nested.boost:(filter.nested.boost=boost,this)},join:function(trueFalse){return null==trueFalse?filter.nested.join:(filter.nested.join=trueFalse,this)},scope:function(){return this},name:function(name){return null==name?filter.nested._name:(filter.nested._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.nested._cache:(filter.nested._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.nested._cache_key:(filter.nested._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.NotFilter=function(oFilter){if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");var filter={not:oFilter._self()};return{filter:function(fltr){if(null==fltr)return filter.not;if(!isFilter(fltr))throw new TypeError("Argument must be a Filter");return filter.not=fltr._self(),this},name:function(name){return null==name?filter.not._name:(filter.not._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.not._cache:(filter.not._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.not._cache_key:(filter.not._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.NumericRangeFilter=function(fieldName){var filter={numeric_range:{}};return filter.numeric_range[fieldName]={},{field:function(field){var oldValue=filter.numeric_range[fieldName];return null==field?fieldName:(delete filter.numeric_range[fieldName],fieldName=field,filter.numeric_range[fieldName]=oldValue,this)},from:function(from){if(null==from)return filter.numeric_range[fieldName].from;if(!isNumber(from))throw new TypeError("Argument must be a numeric value");return filter.numeric_range[fieldName].from=from,this},to:function(to){if(null==to)return filter.numeric_range[fieldName].to;if(!isNumber(to))throw new TypeError("Argument must be a numeric value");return filter.numeric_range[fieldName].to=to,this},includeLower:function(trueFalse){return null==trueFalse?filter.numeric_range[fieldName].include_lower:(filter.numeric_range[fieldName].include_lower=trueFalse,this)},includeUpper:function(trueFalse){return null==trueFalse?filter.numeric_range[fieldName].include_upper:(filter.numeric_range[fieldName].include_upper=trueFalse,this)},gt:function(val){if(null==val)return filter.numeric_range[fieldName].gt;if(!isNumber(val))throw new TypeError("Argument must be a numeric value");return filter.numeric_range[fieldName].gt=val,this},gte:function(val){if(null==val)return filter.numeric_range[fieldName].gte;if(!isNumber(val))throw new TypeError("Argument must be a numeric value");return filter.numeric_range[fieldName].gte=val,this},lt:function(val){if(null==val)return filter.numeric_range[fieldName].lt;if(!isNumber(val))throw new TypeError("Argument must be a numeric value");return filter.numeric_range[fieldName].lt=val,this},lte:function(val){if(null==val)return filter.numeric_range[fieldName].lte;if(!isNumber(val))throw new TypeError("Argument must be a numeric value");return filter.numeric_range[fieldName].lte=val,this},name:function(name){return null==name?filter.numeric_range._name:(filter.numeric_range._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.numeric_range._cache:(filter.numeric_range._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.numeric_range._cache_key:(filter.numeric_range._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.OrFilter=function(filters){var filter,i,len;if(filter={or:{filters:[]}},isFilter(filters))filter.or.filters.push(filters._self());else{if(!isArray(filters))throw new TypeError("Argument must be a Filter or array of Filters");for(i=0,len=filters.length;len>i;i++){if(!isFilter(filters[i]))throw new TypeError("Argument must be array of Filters");filter.or.filters.push(filters[i]._self())}}return{filters:function(fltr){var i,len;if(null==fltr)return filter.or.filters;if(isFilter(fltr))filter.or.filters.push(fltr._self());else{if(!isArray(fltr))throw new TypeError("Argument must be a Filter or array of Filters");for(filter.or.filters=[],i=0,len=fltr.length;len>i;i++){if(!isFilter(fltr[i]))throw new TypeError("Argument must be an array of Filters");filter.or.filters.push(fltr[i]._self())}}return this},name:function(name){return null==name?filter.or._name:(filter.or._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.or._cache:(filter.or._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.or._cache_key:(filter.or._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.PrefixFilter=function(fieldName,prefix){var filter={prefix:{}};return filter.prefix[fieldName]=prefix,{field:function(field){var oldValue=filter.prefix[fieldName];return null==field?fieldName:(delete filter.prefix[fieldName],fieldName=field,filter.prefix[fieldName]=oldValue,this)},prefix:function(value){return null==value?filter.prefix[fieldName]:(filter.prefix[fieldName]=value,this)},name:function(name){return null==name?filter.prefix._name:(filter.prefix._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.prefix._cache:(filter.prefix._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.prefix._cache_key:(filter.prefix._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.QueryFilter=function(qry){if(!isQuery(qry))throw new TypeError("Argument must be a Query");var filter={fquery:{query:qry._self()}};return{query:function(q){if(null==q)return filter.fquery.query;if(!isQuery(q))throw new TypeError("Argument must be a Query");return filter.fquery.query=q._self(),this},name:function(name){return null==name?filter.fquery._name:(filter.fquery._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.fquery._cache:(filter.fquery._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.fquery._cache_key:(filter.fquery._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.RangeFilter=function(field){var filter={range:{}};return filter.range[field]={},{field:function(f){var oldValue=filter.range[field];return null==f?field:(delete filter.range[field],field=f,filter.range[f]=oldValue,this)},from:function(f){return null==f?filter.range[field].from:(filter.range[field].from=f,this)},to:function(t){return null==t?filter.range[field].to:(filter.range[field].to=t,this)},includeLower:function(trueFalse){return null==trueFalse?filter.range[field].include_lower:(filter.range[field].include_lower=trueFalse,this)},includeUpper:function(trueFalse){return null==trueFalse?filter.range[field].include_upper:(filter.range[field].include_upper=trueFalse,this)},gt:function(val){return null==val?filter.range[field].gt:(filter.range[field].gt=val,this)},gte:function(val){return null==val?filter.range[field].gte:(filter.range[field].gte=val,this)},lt:function(val){return null==val?filter.range[field].lt:(filter.range[field].lt=val,this)},lte:function(val){return null==val?filter.range[field].lte:(filter.range[field].lte=val,this)},name:function(name){return null==name?filter.range._name:(filter.range._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.range._cache:(filter.range._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.range._cache_key:(filter.range._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.RegexpFilter=function(field,value){var filter={regexp:{}};return filter.regexp[field]={value:value},{field:function(f){var oldValue=filter.regexp[field];return null==f?field:(delete filter.regexp[field],field=f,filter.regexp[f]=oldValue,this)},value:function(p){return null==p?filter.regexp[field].value:(filter.regexp[field].value=p,this)},flags:function(f){return null==f?filter.regexp[field].flags:(filter.regexp[field].flags=f,this)},flagsValue:function(v){return null==v?filter.regexp[field].flags_value:(filter.regexp[field].flags_value=v,this)},name:function(name){return null==name?filter.regexp._name:(filter.regexp._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.regexp._cache:(filter.regexp._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.regexp._cache_key:(filter.regexp._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.ScriptFilter=function(script){var filter={script:{script:script}};return{script:function(s){return null==s?filter.script.script:(filter.script.script=s,this)},params:function(p){return null==p?filter.script.params:(filter.script.params=p,this)},lang:function(lang){return null==lang?filter.script.lang:(filter.script.lang=lang,this)},name:function(name){return null==name?filter.script._name:(filter.script._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.script._cache:(filter.script._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.script._cache_key:(filter.script._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.TermFilter=function(fieldName,term){var filter={term:{}};return filter.term[fieldName]=term,{field:function(f){var oldValue=filter.term[fieldName];return null==f?fieldName:(delete filter.term[fieldName],fieldName=f,filter.term[fieldName]=oldValue,this)},term:function(v){return null==v?filter.term[fieldName]:(filter.term[fieldName]=v,this)},name:function(name){return null==name?filter.term._name:(filter.term._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.term._cache:(filter.term._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.term._cache_key:(filter.term._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.TermsFilter=function(field,terms){var filter={terms:{}},setupTerms=function(){isArray(filter.terms[field])||(filter.terms[field]=[])},setupLookup=function(){isArray(filter.terms[field])&&(filter.terms[field]={})};return filter.terms[field]=isArray(terms)?terms:[terms],{field:function(f){var oldValue=filter.terms[field];return null==f?field:(delete filter.terms[field],field=f,filter.terms[f]=oldValue,this)},terms:function(t){return setupTerms(),null==t?filter.terms[field]:(isArray(t)?filter.terms[field]=t:filter.terms[field].push(t),this)},index:function(idx){return setupLookup(),null==idx?filter.terms[field].index:(filter.terms[field].index=idx,this)},type:function(type){return setupLookup(),null==type?filter.terms[field].type:(filter.terms[field].type=type,this)},id:function(id){return setupLookup(),null==id?filter.terms[field].id:(filter.terms[field].id=id,this)},path:function(path){return setupLookup(),null==path?filter.terms[field].path:(filter.terms[field].path=path,this)},routing:function(r){return setupLookup(),null==r?filter.terms[field].routing:(filter.terms[field].routing=r,this)},cacheLookup:function(trueFalse){return setupLookup(),null==trueFalse?filter.terms[field].cache:(filter.terms[field].cache=trueFalse,this)},execution:function(e){return null==e?filter.terms.execution:(e=e.toLowerCase(),("plain"===e||"bool"===e||"bool_nocache"===e||"and"===e||"and_nocache"===e||"or"===e||"or_nocache"===e)&&(filter.terms.execution=e),this)},name:function(name){return null==name?filter.terms._name:(filter.terms._name=name,this)},cache:function(trueFalse){return null==trueFalse?filter.terms._cache:(filter.terms._cache=trueFalse,this)},cacheKey:function(key){return null==key?filter.terms._cache_key:(filter.terms._cache_key=key,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.TypeFilter=function(type){var filter={type:{value:type}};return{type:function(type){return null==type?filter.type.value:(filter.type.value=type,this)},toString:function(){return JSON.stringify(filter)},_type:function(){return"filter"},_self:function(){return filter}}},ejs.Document=function(index,type,id){var params={},paramExcludes=["upsert","source","script","lang","params"];return{index:function(idx){return null==idx?index:(index=idx,this)},type:function(t){return null==t?type:(type=t,this)},id:function(i){return null==i?id:(id=i,this)},routing:function(route){return null==route?params.routing:(params.routing=route,this)},parent:function(parent){return null==parent?params.parent:(params.parent=parent,this)},timestamp:function(ts){return null==ts?params.timestamp:(params.timestamp=ts,this)},ttl:function(length){return null==length?params.ttl:(params.ttl=length,this)},timeout:function(length){return null==length?params.timeout:(params.timeout=length,this)},refresh:function(trueFalse){return null==trueFalse?params.refresh:(params.refresh=trueFalse,this)},version:function(version){return null==version?params.version:(params.version=version,this)},versionType:function(vt){return null==vt?params.version_type:(vt=vt.toLowerCase(),("internal"===vt||"external"===vt)&&(params.version_type=vt),this)},opType:function(op){return null==op?params.op_type:(op=op.toLowerCase(),("index"===op||"create"===op)&&(params.op_type=op),this)},replication:function(r){return null==r?params.replication:(r=r.toLowerCase(),("async"===r||"sync"===r||"default"===r)&&(params.replication=r),this)},consistency:function(c){return null==c?params.consistency:(c=c.toLowerCase(),("default"===c||"one"===c||"quorum"===c||"all"===c)&&(params.consistency=c),this)},preference:function(p){return null==p?params.preference:(params.preference=p,this)},realtime:function(trueFalse){return null==trueFalse?params.realtime:(params.realtime=trueFalse,this)},fields:function(fields){if(null==params.fields&&(params.fields=[]),null==fields)return params.fields;if(isString(fields))params.fields.push(fields);else{if(!isArray(fields))throw new TypeError("Argument must be string or array");params.fields=fields}return this},script:function(script){return null==script?params.script:(params.script=script,this)},lang:function(lang){return null==lang?params.lang:(params.lang=lang,this)},params:function(p){if(null==p)return params.params;if(!isObject(p))throw new TypeError("Argument must be an object");return params.params=p,this},retryOnConflict:function(num){return null==num?params.retry_on_conflict:(params.retry_on_conflict=num,this)},upsert:function(doc){if(null==doc)return params.upsert;if(!isObject(doc))throw new TypeError("Argument must be an object");return params.upsert=doc,this},docAsUpsert:function(trueFalse){return null==trueFalse?params.doc_as_upsert:(params.doc_as_upsert=trueFalse,this)},source:function(doc){if(null==doc)return params.source;if(!isObject(doc))throw new TypeError("Argument must be an object");return params.source=doc,this},toString:function(){return JSON.stringify(params)},_type:function(){return"document"},_self:function(){return params},doGet:function(successcb,errorcb){if(null==ejs.client)throw new Error("No Client Set");if(null==index||null==type||null==id)throw new Error("Index, Type, and ID must be set");var url="/"+index+"/"+type+"/"+id;return ejs.client.get(url,genClientParams(params,paramExcludes),successcb,errorcb)},doIndex:function(successcb,errorcb){if(null==ejs.client)throw new Error("No Client Set");if(null==index||null==type)throw new Error("Index and Type must be set");if(null==params.source)throw new Error("No source document found");var response,url="/"+index+"/"+type,data=JSON.stringify(params.source),paramStr=genParamStr(params,paramExcludes);return null!=id&&(url=url+"/"+id),""!==paramStr&&(url=url+"?"+paramStr),response=null==id?ejs.client.post(url,data,successcb,errorcb):ejs.client.put(url,data,successcb,errorcb)},doUpdate:function(successcb,errorcb){if(null==ejs.client)throw new Error("No Client Set");if(null==index||null==type||null==id)throw new Error("Index, Type, and ID must be set");if(null==params.script&&null==params.source)throw new Error("Update script or document required");var url="/"+index+"/"+type+"/"+id+"/_update",data={},paramStr=genParamStr(params,paramExcludes);return""!==paramStr&&(url=url+"?"+paramStr),null!=params.script&&(data.script=params.script),null!=params.lang&&(data.lang=params.lang),null!=params.params&&(data.params=params.params),null!=params.upsert&&(data.upsert=params.upsert),null!=params.source&&(data.doc=params.source),ejs.client.post(url,JSON.stringify(data),successcb,errorcb)},doDelete:function(successcb,errorcb){if(null==ejs.client)throw new Error("No Client Set");if(null==index||null==type||null==id)throw new Error("Index, Type, and ID must be set");var url="/"+index+"/"+type+"/"+id,data="",paramStr=genParamStr(params,paramExcludes);return""!==paramStr&&(url=url+"?"+paramStr),ejs.client.del(url,data,successcb,errorcb)}}},ejs.BoolQuery=function(){var query={bool:{}};return{must:function(oQuery){var i,len;if(null==query.bool.must&&(query.bool.must=[]),null==oQuery)return query.bool.must;if(isQuery(oQuery))query.bool.must.push(oQuery._self());else{if(!isArray(oQuery))throw new TypeError("Argument must be a Query or array of Queries");for(query.bool.must=[],i=0,len=oQuery.length;len>i;i++){if(!isQuery(oQuery[i]))throw new TypeError("Argument must be an array of Queries");query.bool.must.push(oQuery[i]._self())}}return this},mustNot:function(oQuery){var i,len;if(null==query.bool.must_not&&(query.bool.must_not=[]),null==oQuery)return query.bool.must_not;if(isQuery(oQuery))query.bool.must_not.push(oQuery._self());else{if(!isArray(oQuery))throw new TypeError("Argument must be a Query or array of Queries");for(query.bool.must_not=[],i=0,len=oQuery.length;len>i;i++){if(!isQuery(oQuery[i]))throw new TypeError("Argument must be an array of Queries");query.bool.must_not.push(oQuery[i]._self())}}return this},should:function(oQuery){var i,len;if(null==query.bool.should&&(query.bool.should=[]),null==oQuery)return query.bool.should;if(isQuery(oQuery))query.bool.should.push(oQuery._self());else{if(!isArray(oQuery))throw new TypeError("Argument must be a Query or array of Queries");for(query.bool.should=[],i=0,len=oQuery.length;len>i;i++){if(!isQuery(oQuery[i]))throw new TypeError("Argument must be an array of Queries");query.bool.should.push(oQuery[i]._self())}}return this},boost:function(boost){return null==boost?query.bool.boost:(query.bool.boost=boost,this)},adjustPureNegative:function(trueFalse){return null==trueFalse?query.bool.adjust_pure_negative:(query.bool.adjust_pure_negative=trueFalse,this)},disableCoord:function(trueFalse){return null==trueFalse?query.bool.disable_coord:(query.bool.disable_coord=trueFalse,this)},minimumNumberShouldMatch:function(minMatch){return null==minMatch?query.bool.minimum_number_should_match:(query.bool.minimum_number_should_match=minMatch,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.BoostingQuery=function(positiveQry,negativeQry,negativeBoost){if(!isQuery(positiveQry)||!isQuery(negativeQry))throw new TypeError("Arguments must be Queries");var query={boosting:{positive:positiveQry._self(),negative:negativeQry._self(),negative_boost:negativeBoost}};return{positive:function(oQuery){if(null==oQuery)return query.boosting.positive;if(!isQuery(oQuery))throw new TypeError("Argument must be a Query");return query.boosting.positive=oQuery._self(),this},negative:function(oQuery){if(null==oQuery)return query.boosting.negative;if(!isQuery(oQuery))throw new TypeError("Argument must be a Query");return query.boosting.negative=oQuery._self(),this},negativeBoost:function(negBoost){return null==negBoost?query.boosting.negative_boost:(query.boosting.negative_boost=negBoost,this)},boost:function(boost){return null==boost?query.boosting.boost:(query.boosting.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.CommonTermsQuery=function(field,qstr){var query={common:{}};return null==field&&(field="no_field_set"),query.common[field]={},null!=qstr&&(query.common[field].query=qstr),{field:function(f){var oldValue=query.common[field];return null==f?field:(delete query.common[field],field=f,query.common[f]=oldValue,this)},query:function(qstr){return null==qstr?query.common[field].query:(query.common[field].query=qstr,this)},analyzer:function(analyzer){return null==analyzer?query.common[field].analyzer:(query.common[field].analyzer=analyzer,this)},disableCoord:function(trueFalse){return null==trueFalse?query.common[field].disable_coord:(query.common[field].disable_coord=trueFalse,this)},cutoffFrequency:function(freq){return null==freq?query.common[field].cutoff_frequency:(query.common[field].cutoff_frequency=freq,this)},highFreqOperator:function(op){return null==op?query.common[field].high_freq_operator:(op=op.toLowerCase(),("and"===op||"or"===op)&&(query.common[field].high_freq_operator=op),this)},lowFreqOperator:function(op){return null==op?query.common[field].low_freq_operator:(op=op.toLowerCase(),("and"===op||"or"===op)&&(query.common[field].low_freq_operator=op),this)},minimumShouldMatch:function(min){return null==min?query.common[field].minimum_should_match.low_freq:(null==query.common[field].minimum_should_match&&(query.common[field].minimum_should_match={}),query.common[field].minimum_should_match.low_freq=min,this)},minimumShouldMatchLowFreq:function(min){return this.minimumShouldMatch(min)},minimumShouldMatchHighFreq:function(min){return null==min?query.common[field].minimum_should_match.high_freq:(null==query.common[field].minimum_should_match&&(query.common[field].minimum_should_match={}),query.common[field].minimum_should_match.high_freq=min,this)},boost:function(boost){return null==boost?query.common[field].boost:(query.common[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.ConstantScoreQuery=function(){var query={constant_score:{}};return{query:function(oQuery){if(null==oQuery)return query.constant_score.query;if(!isQuery(oQuery))throw new TypeError("Argument must be a Query");return query.constant_score.query=oQuery._self(),this},filter:function(oFilter){if(null==oFilter)return query.constant_score.filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return query.constant_score.filter=oFilter._self(),this},cache:function(trueFalse){return null==trueFalse?query.constant_score._cache:(query.constant_score._cache=trueFalse,this)},cacheKey:function(k){return null==k?query.constant_score._cache_key:(query.constant_score._cache_key=k,this)},boost:function(boost){return null==boost?query.constant_score.boost:(query.constant_score.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.CustomBoostFactorQuery=function(qry){if(!isQuery(qry))throw new TypeError("Argument must be a Query");var query={custom_boost_factor:{query:qry._self()}};return{query:function(q){if(null==q)return query.custom_boost_factor.query;if(!isQuery(q))throw new TypeError("Argument must be a Query");return query.custom_boost_factor.query=q._self(),this},boostFactor:function(boost){return null==boost?query.custom_boost_factor.boost_factor:(query.custom_boost_factor.boost_factor=boost,this)
},boost:function(boost){return null==boost?query.custom_boost_factor.boost:(query.custom_boost_factor.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.CustomFiltersScoreQuery=function(qry,filters){if(!isQuery(qry))throw new TypeError("Argument must be a Query");var query={custom_filters_score:{query:qry._self(),filters:[]}},genFilterObject=function(filter){var obj=null;return filter.filter&&isFilter(filter.filter)&&(obj={filter:filter.filter._self()},filter.boost?obj.boost=filter.boost:filter.script?obj.script=filter.script:obj=null),obj};return each(isArray(filters)?filters:[filters],function(filter){var fObj=genFilterObject(filter);null!==fObj&&query.custom_filters_score.filters.push(fObj)}),{query:function(q){if(null==q)return query.custom_filters_score.query;if(!isQuery(q))throw new TypeError("Argument must be a Query");return query.custom_filters_score.query=q._self(),this},filters:function(fltrs){return null==fltrs?query.custom_filters_score.filters:(isArray(fltrs)&&(query.custom_filters_score.filters=[]),each(isArray(fltrs)?fltrs:[fltrs],function(f){var fObj=genFilterObject(f);null!==fObj&&query.custom_filters_score.filters.push(fObj)}),this)},scoreMode:function(s){return null==s?query.custom_filters_score.score_mode:(s=s.toLowerCase(),("first"===s||"min"===s||"max"===s||"total"===s||"avg"===s||"multiply"===s)&&(query.custom_filters_score.score_mode=s),this)},params:function(p){return null==p?query.custom_filters_score.params:(query.custom_filters_score.params=p,this)},lang:function(l){return null==l?query.custom_filters_score.lang:(query.custom_filters_score.lang=l,this)},maxBoost:function(max){return null==max?query.custom_filters_score.max_boost:(query.custom_filters_score.max_boost=max,this)},boost:function(boost){return null==boost?query.custom_filters_score.boost:(query.custom_filters_score.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.CustomScoreQuery=function(qry,script){if(!isQuery(qry)&&!isFilter(qry))throw new TypeError("Argument must be a Query or Filter");var query={custom_score:{script:script}};return isQuery(qry)?query.custom_score.query=qry._self():isFilter(qry)&&(query.custom_score.filter=qry._self()),{query:function(q){if(null==q)return query.custom_score.query;if(!isQuery(q))throw new TypeError("Argument must be a Query");return query.custom_score.query=q._self(),this},filter:function(f){if(null==f)return query.custom_score.filter;if(!isFilter(f))throw new TypeError("Argument must be a Filter");return query.custom_score.filter=f._self(),this},script:function(s){return null==s?query.custom_score.script:(query.custom_score.script=s,this)},params:function(p){return null==p?query.custom_score.params:(query.custom_score.params=p,this)},lang:function(l){return null==l?query.custom_score.lang:(query.custom_score.lang=l,this)},boost:function(boost){return null==boost?query.custom_score.boost:(query.custom_score.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.DisMaxQuery=function(){var query={dis_max:{}};return{queries:function(qs){var i,len;if(null==qs)return query.dis_max.queries;if(null==query.dis_max.queries&&(query.dis_max.queries=[]),isQuery(qs))query.dis_max.queries.push(qs._self());else{if(!isArray(qs))throw new TypeError("Argument must be a Query or array of Queries");for(query.dis_max.queries=[],i=0,len=qs.length;len>i;i++){if(!isQuery(qs[i]))throw new TypeError("Argument must be array of Queries");query.dis_max.queries.push(qs[i]._self())}}return this},boost:function(boost){return null==boost?query.dis_max.boost:(query.dis_max.boost=boost,this)},tieBreaker:function(tieBreaker){return null==tieBreaker?query.dis_max.tie_breaker:(query.dis_max.tie_breaker=tieBreaker,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.FieldMaskingSpanQuery=function(spanQry,field){if(!isQuery(spanQry))throw new TypeError("Argument must be a SpanQuery");var query={field_masking_span:{query:spanQry._self(),field:field}};return{query:function(spanQuery){if(null==spanQuery)return query.field_masking_span.query;if(!isQuery(spanQuery))throw new TypeError("Argument must be a SpanQuery");return query.field_masking_span.query=spanQuery._self(),this},field:function(f){return null==f?query.field_masking_span.field:(query.field_masking_span.field=f,this)},boost:function(boost){return null==boost?query.field_masking_span.boost:(query.field_masking_span.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.FieldQuery=function(field,qstr){var query={field:{}};return query.field[field]={query:qstr},{field:function(f){var oldValue=query.field[field];return null==f?field:(delete query.field[field],field=f,query.field[f]=oldValue,this)},query:function(q){return null==q?query.field[field].query:(query.field[field].query=q,this)},defaultOperator:function(op){return null==op?query.field[field].default_operator:(op=op.toUpperCase(),("AND"===op||"OR"===op)&&(query.field[field].default_operator=op),this)},analyzer:function(analyzer){return null==analyzer?query.field[field].analyzer:(query.field[field].analyzer=analyzer,this)},quoteAnalyzer:function(analyzer){return null==analyzer?query.field[field].quote_analyzer:(query.field[field].quote_analyzer=analyzer,this)},autoGeneratePhraseQueries:function(trueFalse){return null==trueFalse?query.field[field].auto_generate_phrase_queries:(query.field[field].auto_generate_phrase_queries=trueFalse,this)},allowLeadingWildcard:function(trueFalse){return null==trueFalse?query.field[field].allow_leading_wildcard:(query.field[field].allow_leading_wildcard=trueFalse,this)},lowercaseExpandedTerms:function(trueFalse){return null==trueFalse?query.field[field].lowercase_expanded_terms:(query.field[field].lowercase_expanded_terms=trueFalse,this)},enablePositionIncrements:function(trueFalse){return null==trueFalse?query.field[field].enable_position_increments:(query.field[field].enable_position_increments=trueFalse,this)},fuzzyMinSim:function(minSim){return null==minSim?query.field[field].fuzzy_min_sim:(query.field[field].fuzzy_min_sim=minSim,this)},boost:function(boost){return null==boost?query.field[field].boost:(query.field[field].boost=boost,this)},fuzzyPrefixLength:function(fuzzLen){return null==fuzzLen?query.field[field].fuzzy_prefix_length:(query.field[field].fuzzy_prefix_length=fuzzLen,this)},fuzzyMaxExpansions:function(max){return null==max?query.field[field].fuzzy_max_expansions:(query.field[field].fuzzy_max_expansions=max,this)},fuzzyRewrite:function(m){return null==m?query.field[field].fuzzy_rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.field[field].fuzzy_rewrite=m),this)},rewrite:function(m){return null==m?query.field[field].rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.field[field].rewrite=m),this)},quoteFieldSuffix:function(s){return null==s?query.field[field].quote_field_suffix:(query.field[field].quote_field_suffix=s,this)},phraseSlop:function(slop){return null==slop?query.field[field].phrase_slop:(query.field[field].phrase_slop=slop,this)},analyzeWildcard:function(trueFalse){return null==trueFalse?query.field[field].analyze_wildcard:(query.field[field].analyze_wildcard=trueFalse,this)},escape:function(trueFalse){return null==trueFalse?query.field[field].escape:(query.field[field].escape=trueFalse,this)},minimumShouldMatch:function(minMatch){return null==minMatch?query.field[field].minimum_should_match:(query.field[field].minimum_should_match=minMatch,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.FilteredQuery=function(someQuery,someFilter){if(!isQuery(someQuery))throw new TypeError("Argument must be a Query");if(null!=someFilter&&!isFilter(someFilter))throw new TypeError("Argument must be a Filter");var query={filtered:{query:someQuery._self()}};return null!=someFilter&&(query.filtered.filter=someFilter._self()),{query:function(oQuery){if(null==oQuery)return query.filtered.query;if(!isQuery(oQuery))throw new TypeError("Argument must be a Query");return query.filtered.query=oQuery._self(),this},filter:function(oFilter){if(null==oFilter)return query.filtered.filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return query.filtered.filter=oFilter._self(),this},strategy:function(strategy){return null==strategy?query.filtered.strategy:(strategy=strategy.toLowerCase(),("query_first"===strategy||"random_access_always"===strategy||"leap_frog"===strategy||"leap_frog_filter_first"===strategy||0===strategy.indexOf("random_access_"))&&(query.filtered.strategy=strategy),this)},cache:function(trueFalse){return null==trueFalse?query.filtered._cache:(query.filtered._cache=trueFalse,this)},cacheKey:function(k){return null==k?query.filtered._cache_key:(query.filtered._cache_key=k,this)},boost:function(boost){return null==boost?query.filtered.boost:(query.filtered.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.FuzzyLikeThisFieldQuery=function(field,likeText){var query={flt_field:{}};return query.flt_field[field]={like_text:likeText},{field:function(f){var oldValue=query.flt_field[field];return null==f?field:(delete query.flt_field[field],field=f,query.flt_field[f]=oldValue,this)},likeText:function(txt){return null==txt?query.flt_field[field].like_text:(query.flt_field[field].like_text=txt,this)},ignoreTf:function(trueFalse){return null==trueFalse?query.flt_field[field].ignore_tf:(query.flt_field[field].ignore_tf=trueFalse,this)},maxQueryTerms:function(max){return null==max?query.flt_field[field].max_query_terms:(query.flt_field[field].max_query_terms=max,this)},minSimilarity:function(min){return null==min?query.flt_field[field].min_similarity:(query.flt_field[field].min_similarity=min,this)},prefixLength:function(len){return null==len?query.flt_field[field].prefix_length:(query.flt_field[field].prefix_length=len,this)},analyzer:function(analyzerName){return null==analyzerName?query.flt_field[field].analyzer:(query.flt_field[field].analyzer=analyzerName,this)},failOnUnsupportedField:function(trueFalse){return null==trueFalse?query.flt_field[field].fail_on_unsupported_field:(query.flt_field[field].fail_on_unsupported_field=trueFalse,this)},boost:function(boost){return null==boost?query.flt_field[field].boost:(query.flt_field[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.FuzzyLikeThisQuery=function(likeText){var query={flt:{like_text:likeText}};return{fields:function(f){if(null==query.flt.fields&&(query.flt.fields=[]),null==f)return query.flt.fields;if(isString(f))query.flt.fields.push(f);else{if(!isArray(f))throw new TypeError("Argument must be a string or array");query.flt.fields=f}return this},likeText:function(txt){return null==txt?query.flt.like_text:(query.flt.like_text=txt,this)},ignoreTf:function(trueFalse){return null==trueFalse?query.flt.ignore_tf:(query.flt.ignore_tf=trueFalse,this)},maxQueryTerms:function(max){return null==max?query.flt.max_query_terms:(query.flt.max_query_terms=max,this)},minSimilarity:function(min){return null==min?query.flt.min_similarity:(query.flt.min_similarity=min,this)},prefixLength:function(len){return null==len?query.flt.prefix_length:(query.flt.prefix_length=len,this)},analyzer:function(analyzerName){return null==analyzerName?query.flt.analyzer:(query.flt.analyzer=analyzerName,this)},failOnUnsupportedField:function(trueFalse){return null==trueFalse?query.flt.fail_on_unsupported_field:(query.flt.fail_on_unsupported_field=trueFalse,this)},boost:function(boost){return null==boost?query.flt.boost:(query.flt.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.FuzzyQuery=function(field,value){var query={fuzzy:{}};return query.fuzzy[field]={value:value},{field:function(f){var oldValue=query.fuzzy[field];return null==f?field:(delete query.fuzzy[field],field=f,query.fuzzy[f]=oldValue,this)},value:function(txt){return null==txt?query.fuzzy[field].value:(query.fuzzy[field].value=txt,this)},transpositions:function(trueFalse){return null==trueFalse?query.fuzzy[field].transpositions:(query.fuzzy[field].transpositions=trueFalse,this)},maxExpansions:function(max){return null==max?query.fuzzy[field].max_expansions:(query.fuzzy[field].max_expansions=max,this)},minSimilarity:function(min){return null==min?query.fuzzy[field].min_similarity:(query.fuzzy[field].min_similarity=min,this)},prefixLength:function(len){return null==len?query.fuzzy[field].prefix_length:(query.fuzzy[field].prefix_length=len,this)},rewrite:function(m){return null==m?query.fuzzy[field].rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.fuzzy[field].rewrite=m),this)},boost:function(boost){return null==boost?query.fuzzy[field].boost:(query.fuzzy[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.GeoShapeQuery=function(field){var query={geo_shape:{}};return query.geo_shape[field]={},{field:function(f){var oldValue=query.geo_shape[field];return null==f?field:(delete query.geo_shape[field],field=f,query.geo_shape[f]=oldValue,this)},shape:function(shape){return null==shape?query.geo_shape[field].shape:(null!=query.geo_shape[field].indexed_shape&&delete query.geo_shape[field].indexed_shape,query.geo_shape[field].shape=shape._self(),this)},indexedShape:function(indexedShape){return null==indexedShape?query.geo_shape[field].indexed_shape:(null!=query.geo_shape[field].shape&&delete query.geo_shape[field].shape,query.geo_shape[field].indexed_shape=indexedShape._self(),this)},relation:function(relation){return null==relation?query.geo_shape[field].relation:(relation=relation.toLowerCase(),("intersects"===relation||"disjoint"===relation||"within"===relation)&&(query.geo_shape[field].relation=relation),this)},strategy:function(strategy){return null==strategy?query.geo_shape[field].strategy:(strategy=strategy.toLowerCase(),("recursive"===strategy||"term"===strategy)&&(query.geo_shape[field].strategy=strategy),this)},boost:function(boost){return null==boost?query.geo_shape[field].boost:(query.geo_shape[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.HasChildQuery=function(qry,type){if(!isQuery(qry))throw new TypeError("Argument must be a valid Query");var query={has_child:{query:qry._self(),type:type}};return{query:function(q){if(null==q)return query.has_child.query;if(!isQuery(q))throw new TypeError("Argument must be a valid Query");return query.has_child.query=q._self(),this},type:function(t){return null==t?query.has_child.type:(query.has_child.type=t,this)},scope:function(){return this},scoreType:function(s){return null==s?query.has_child.score_type:(s=s.toLowerCase(),("none"===s||"max"===s||"sum"===s||"avg"===s)&&(query.has_child.score_type=s),this)},scoreMode:function(s){return null==s?query.has_child.score_mode:(s=s.toLowerCase(),("none"===s||"max"===s||"sum"===s||"avg"===s)&&(query.has_child.score_mode=s),this)},shortCircuitCutoff:function(cutoff){return null==cutoff?query.has_child.short_circuit_cutoff:(query.has_child.short_circuit_cutoff=cutoff,this)},boost:function(boost){return null==boost?query.has_child.boost:(query.has_child.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.HasParentQuery=function(qry,parentType){if(!isQuery(qry))throw new TypeError("Argument must be a Query");var query={has_parent:{query:qry._self(),parent_type:parentType}};return{query:function(q){if(null==q)return query.has_parent.query;if(!isQuery(q))throw new TypeError("Argument must be a Query");return query.has_parent.query=q._self(),this},parentType:function(t){return null==t?query.has_parent.parent_type:(query.has_parent.parent_type=t,this)},scope:function(){return this},scoreType:function(s){return null==s?query.has_parent.score_type:(s=s.toLowerCase(),("none"===s||"score"===s)&&(query.has_parent.score_type=s),this)},scoreMode:function(s){return null==s?query.has_parent.score_mode:(s=s.toLowerCase(),("none"===s||"score"===s)&&(query.has_parent.score_mode=s),this)},boost:function(boost){return null==boost?query.has_parent.boost:(query.has_parent.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.IdsQuery=function(ids){var query={ids:{}};if(isString(ids))query.ids.values=[ids];else{if(!isArray(ids))throw new TypeError("Argument must be string or array");query.ids.values=ids}return{values:function(val){if(null==val)return query.ids.values;if(isString(val))query.ids.values.push(val);else{if(!isArray(val))throw new TypeError("Argument must be string or array");query.ids.values=val}return this},type:function(type){if(null==query.ids.type&&(query.ids.type=[]),null==type)return query.ids.type;if(isString(type))query.ids.type.push(type);else{if(!isArray(type))throw new TypeError("Argument must be string or array");query.ids.type=type}return this},boost:function(boost){return null==boost?query.ids.boost:(query.ids.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.IndicesQuery=function(qry,indices){if(!isQuery(qry))throw new TypeError("Argument must be a Query");var query={indices:{query:qry._self()}};if(isString(indices))query.indices.indices=[indices];else{if(!isArray(indices))throw new TypeError("Argument must be a string or array");query.indices.indices=indices}return{indices:function(i){if(null==i)return query.indices.indices;if(isString(i))query.indices.indices.push(i);else{if(!isArray(i))throw new TypeError("Argument must be a string or array");query.indices.indices=i}return this},query:function(q){if(null==q)return query.indices.query;if(!isQuery(q))throw new TypeError("Argument must be a Query");return query.indices.query=q._self(),this},noMatchQuery:function(q){if(null==q)return query.indices.no_match_query;if(isString(q))q=q.toLowerCase(),("none"===q||"all"===q)&&(query.indices.no_match_query=q);else{if(!isQuery(q))throw new TypeError("Argument must be string or Query");query.indices.no_match_query=q._self()}return this},boost:function(boost){return null==boost?query.indices.boost:(query.indices.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.MatchAllQuery=function(){var query={match_all:{}};return{boost:function(boost){return null==boost?query.match_all.boost:(query.match_all.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.MatchQuery=function(field,qstr){var query={match:{}};return query.match[field]={query:qstr},{boost:function(boost){return null==boost?query.match[field].boost:(query.match[field].boost=boost,this)},query:function(qstr){return null==qstr?query.match[field].query:(query.match[field].query=qstr,this)},type:function(type){return null==type?query.match[field].type:(type=type.toLowerCase(),("boolean"===type||"phrase"===type||"phrase_prefix"===type)&&(query.match[field].type=type),this)},fuzziness:function(fuzz){return null==fuzz?query.match[field].fuzziness:(query.match[field].fuzziness=fuzz,this)},cutoffFrequency:function(freq){return null==freq?query.match[field].cutoff_frequency:(query.match[field].cutoff_frequency=freq,this)},prefixLength:function(l){return null==l?query.match[field].prefix_length:(query.match[field].prefix_length=l,this)},maxExpansions:function(e){return null==e?query.match[field].max_expansions:(query.match[field].max_expansions=e,this)},operator:function(op){return null==op?query.match[field].operator:(op=op.toLowerCase(),("and"===op||"or"===op)&&(query.match[field].operator=op),this)},slop:function(slop){return null==slop?query.match[field].slop:(query.match[field].slop=slop,this)},analyzer:function(analyzer){return null==analyzer?query.match[field].analyzer:(query.match[field].analyzer=analyzer,this)},minimumShouldMatch:function(minMatch){return null==minMatch?query.match[field].minimum_should_match:(query.match[field].minimum_should_match=minMatch,this)},rewrite:function(m){return null==m?query.match[field].rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.match[field].rewrite=m),this)},fuzzyRewrite:function(m){return null==m?query.match[field].fuzzy_rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.match[field].fuzzy_rewrite=m),this)},fuzzyTranspositions:function(trueFalse){return null==trueFalse?query.match[field].fuzzy_transpositions:(query.match[field].fuzzy_transpositions=trueFalse,this)},lenient:function(trueFalse){return null==trueFalse?query.match[field].lenient:(query.match[field].lenient=trueFalse,this)},zeroTermsQuery:function(q){return null==q?query.match[field].zero_terms_query:(q=q.toLowerCase(),("all"===q||"none"===q)&&(query.match[field].zero_terms_query=q),this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.MoreLikeThisFieldQuery=function(field,likeText){var query={mlt_field:{}};return query.mlt_field[field]={like_text:likeText},{field:function(f){var oldValue=query.mlt_field[field];return null==f?field:(delete query.mlt_field[field],field=f,query.mlt_field[f]=oldValue,this)},likeText:function(txt){return null==txt?query.mlt_field[field].like_text:(query.mlt_field[field].like_text=txt,this)},percentTermsToMatch:function(percent){return null==percent?query.mlt_field[field].percent_terms_to_match:(query.mlt_field[field].percent_terms_to_match=percent,this)},minTermFreq:function(freq){return null==freq?query.mlt_field[field].min_term_freq:(query.mlt_field[field].min_term_freq=freq,this)},maxQueryTerms:function(max){return null==max?query.mlt_field[field].max_query_terms:(query.mlt_field[field].max_query_terms=max,this)},stopWords:function(stopWords){return null==stopWords?query.mlt_field[field].stop_words:(query.mlt_field[field].stop_words=stopWords,this)},minDocFreq:function(min){return null==min?query.mlt_field[field].min_doc_freq:(query.mlt_field[field].min_doc_freq=min,this)},maxDocFreq:function(max){return null==max?query.mlt_field[field].max_doc_freq:(query.mlt_field[field].max_doc_freq=max,this)},minWordLen:function(len){return null==len?query.mlt_field[field].min_word_len:(query.mlt_field[field].min_word_len=len,this)},maxWordLen:function(len){return null==len?query.mlt_field[field].max_word_len:(query.mlt_field[field].max_word_len=len,this)},analyzer:function(analyzerName){return null==analyzerName?query.mlt_field[field].analyzer:(query.mlt_field[field].analyzer=analyzerName,this)},boostTerms:function(boost){return null==boost?query.mlt_field[field].boost_terms:(query.mlt_field[field].boost_terms=boost,this)},failOnUnsupportedField:function(trueFalse){return null==trueFalse?query.mlt_field[field].fail_on_unsupported_field:(query.mlt_field[field].fail_on_unsupported_field=trueFalse,this)},boost:function(boost){return null==boost?query.mlt_field[field].boost:(query.mlt_field[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.MoreLikeThisQuery=function(fields,likeText){var query={mlt:{like_text:likeText,fields:[]}};if(isString(fields))query.mlt.fields.push(fields);else{if(!isArray(fields))throw new TypeError("Argument must be string or array");query.mlt.fields=fields}return{fields:function(f){if(null==f)return query.mlt.fields;if(isString(f))query.mlt.fields.push(f);else{if(!isArray(f))throw new TypeError("Argument must be a string or array");query.mlt.fields=f}return this},likeText:function(txt){return null==txt?query.mlt.like_text:(query.mlt.like_text=txt,this)},percentTermsToMatch:function(percent){return null==percent?query.mlt.percent_terms_to_match:(query.mlt.percent_terms_to_match=percent,this)},minTermFreq:function(freq){return null==freq?query.mlt.min_term_freq:(query.mlt.min_term_freq=freq,this)},maxQueryTerms:function(max){return null==max?query.mlt.max_query_terms:(query.mlt.max_query_terms=max,this)},stopWords:function(stopWords){return null==stopWords?query.mlt.stop_words:(query.mlt.stop_words=stopWords,this)},minDocFreq:function(min){return null==min?query.mlt.min_doc_freq:(query.mlt.min_doc_freq=min,this)},maxDocFreq:function(max){return null==max?query.mlt.max_doc_freq:(query.mlt.max_doc_freq=max,this)},minWordLen:function(len){return null==len?query.mlt.min_word_len:(query.mlt.min_word_len=len,this)},maxWordLen:function(len){return null==len?query.mlt.max_word_len:(query.mlt.max_word_len=len,this)},analyzer:function(analyzerName){return null==analyzerName?query.mlt.analyzer:(query.mlt.analyzer=analyzerName,this)},boostTerms:function(boost){return null==boost?query.mlt.boost_terms:(query.mlt.boost_terms=boost,this)},failOnUnsupportedField:function(trueFalse){return null==trueFalse?query.mlt.fail_on_unsupported_field:(query.mlt.fail_on_unsupported_field=trueFalse,this)},boost:function(boost){return null==boost?query.mlt.boost:(query.mlt.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.MultiMatchQuery=function(fields,qstr){var query={multi_match:{query:qstr,fields:[]}};if(isString(fields))query.multi_match.fields.push(fields);else{if(!isArray(fields))throw new TypeError("Argument must be string or array");query.multi_match.fields=fields}return{fields:function(f){if(null==f)return query.multi_match.fields;if(isString(f))query.multi_match.fields.push(f);else{if(!isArray(f))throw new TypeError("Argument must be string or array");query.multi_match.fields=f}return this},useDisMax:function(trueFalse){return null==trueFalse?query.multi_match.use_dis_max:(query.multi_match.use_dis_max=trueFalse,this)},tieBreaker:function(tieBreaker){return null==tieBreaker?query.multi_match.tie_breaker:(query.multi_match.tie_breaker=tieBreaker,this)},cutoffFrequency:function(freq){return null==freq?query.multi_match.cutoff_frequency:(query.multi_match.cutoff_frequency=freq,this)},minimumShouldMatch:function(minMatch){return null==minMatch?query.multi_match.minimum_should_match:(query.multi_match.minimum_should_match=minMatch,this)},rewrite:function(m){return null==m?query.multi_match.rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.multi_match.rewrite=m),this)},fuzzyRewrite:function(m){return null==m?query.multi_match.fuzzy_rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.multi_match.fuzzy_rewrite=m),this)},lenient:function(trueFalse){return null==trueFalse?query.multi_match.lenient:(query.multi_match.lenient=trueFalse,this)},boost:function(boost){return null==boost?query.multi_match.boost:(query.multi_match.boost=boost,this)},query:function(qstr){return null==qstr?query.multi_match.query:(query.multi_match.query=qstr,this)},type:function(type){return null==type?query.multi_match.type:(type=type.toLowerCase(),("boolean"===type||"phrase"===type||"phrase_prefix"===type)&&(query.multi_match.type=type),this)},fuzziness:function(fuzz){return null==fuzz?query.multi_match.fuzziness:(query.multi_match.fuzziness=fuzz,this)},prefixLength:function(l){return null==l?query.multi_match.prefix_length:(query.multi_match.prefix_length=l,this)},maxExpansions:function(e){return null==e?query.multi_match.max_expansions:(query.multi_match.max_expansions=e,this)},operator:function(op){return null==op?query.multi_match.operator:(op=op.toLowerCase(),("and"===op||"or"===op)&&(query.multi_match.operator=op),this)},slop:function(slop){return null==slop?query.multi_match.slop:(query.multi_match.slop=slop,this)},analyzer:function(analyzer){return null==analyzer?query.multi_match.analyzer:(query.multi_match.analyzer=analyzer,this)},zeroTermsQuery:function(q){return null==q?query.multi_match.zero_terms_query:(q=q.toLowerCase(),("all"===q||"none"===q)&&(query.multi_match.zero_terms_query=q),this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.NestedQuery=function(path){var query={nested:{path:path}};return{path:function(path){return null==path?query.nested.path:(query.nested.path=path,this)},query:function(oQuery){if(null==oQuery)return query.nested.query;if(!isQuery(oQuery))throw new TypeError("Argument must be a Query");return query.nested.query=oQuery._self(),this},filter:function(oFilter){if(null==oFilter)return query.nested.filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return query.nested.filter=oFilter._self(),this},scoreMode:function(mode){return null==mode?query.nested.score_mode:(mode=mode.toLowerCase(),("avg"===mode||"total"===mode||"max"===mode||"none"===mode||"sum"===mode)&&(query.nested.score_mode=mode),this)},scope:function(){return this},boost:function(boost){return null==boost?query.nested.boost:(query.nested.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.PrefixQuery=function(field,value){var query={prefix:{}};return query.prefix[field]={value:value},{field:function(f){var oldValue=query.prefix[field];return null==f?field:(delete query.prefix[field],field=f,query.prefix[f]=oldValue,this)},value:function(p){return null==p?query.prefix[field].value:(query.prefix[field].value=p,this)},rewrite:function(m){return null==m?query.prefix[field].rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.prefix[field].rewrite=m),this)},boost:function(boost){return null==boost?query.prefix[field].boost:(query.prefix[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.QueryStringQuery=function(qstr){var query={query_string:{}};return query.query_string.query=qstr,{query:function(qstr){return null==qstr?query.query_string.query:(query.query_string.query=qstr,this)},defaultField:function(fieldName){return null==fieldName?query.query_string.default_field:(query.query_string.default_field=fieldName,this)},fields:function(fieldNames){if(null==query.query_string.fields&&(query.query_string.fields=[]),null==fieldNames)return query.query_string.fields;if(isString(fieldNames))query.query_string.fields.push(fieldNames);else{if(!isArray(fieldNames))throw new TypeError("Argument must be a string or array");query.query_string.fields=fieldNames}return this},useDisMax:function(trueFalse){return null==trueFalse?query.query_string.use_dis_max:(query.query_string.use_dis_max=trueFalse,this)},defaultOperator:function(op){return null==op?query.query_string.default_operator:(op=op.toUpperCase(),("AND"===op||"OR"===op)&&(query.query_string.default_operator=op),this)},analyzer:function(analyzer){return null==analyzer?query.query_string.analyzer:(query.query_string.analyzer=analyzer,this)},quoteAnalyzer:function(analyzer){return null==analyzer?query.query_string.quote_analyzer:(query.query_string.quote_analyzer=analyzer,this)},allowLeadingWildcard:function(trueFalse){return null==trueFalse?query.query_string.allow_leading_wildcard:(query.query_string.allow_leading_wildcard=trueFalse,this)
},lowercaseExpandedTerms:function(trueFalse){return null==trueFalse?query.query_string.lowercase_expanded_terms:(query.query_string.lowercase_expanded_terms=trueFalse,this)},enablePositionIncrements:function(trueFalse){return null==trueFalse?query.query_string.enable_position_increments:(query.query_string.enable_position_increments=trueFalse,this)},fuzzyPrefixLength:function(fuzzLen){return null==fuzzLen?query.query_string.fuzzy_prefix_length:(query.query_string.fuzzy_prefix_length=fuzzLen,this)},fuzzyMinSim:function(minSim){return null==minSim?query.query_string.fuzzy_min_sim:(query.query_string.fuzzy_min_sim=minSim,this)},phraseSlop:function(slop){return null==slop?query.query_string.phrase_slop:(query.query_string.phrase_slop=slop,this)},boost:function(boost){return null==boost?query.query_string.boost:(query.query_string.boost=boost,this)},analyzeWildcard:function(trueFalse){return null==trueFalse?query.query_string.analyze_wildcard:(query.query_string.analyze_wildcard=trueFalse,this)},autoGeneratePhraseQueries:function(trueFalse){return null==trueFalse?query.query_string.auto_generate_phrase_queries:(query.query_string.auto_generate_phrase_queries=trueFalse,this)},minimumShouldMatch:function(minMatch){return null==minMatch?query.query_string.minimum_should_match:(query.query_string.minimum_should_match=minMatch,this)},tieBreaker:function(tieBreaker){return null==tieBreaker?query.query_string.tie_breaker:(query.query_string.tie_breaker=tieBreaker,this)},escape:function(trueFalse){return null==trueFalse?query.query_string.escape:(query.query_string.escape=trueFalse,this)},fuzzyMaxExpansions:function(max){return null==max?query.query_string.fuzzy_max_expansions:(query.query_string.fuzzy_max_expansions=max,this)},fuzzyRewrite:function(m){return null==m?query.query_string.fuzzy_rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.query_string.fuzzy_rewrite=m),this)},rewrite:function(m){return null==m?query.query_string.rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.query_string.rewrite=m),this)},quoteFieldSuffix:function(s){return null==s?query.query_string.quote_field_suffix:(query.query_string.quote_field_suffix=s,this)},lenient:function(trueFalse){return null==trueFalse?query.query_string.lenient:(query.query_string.lenient=trueFalse,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.RangeQuery=function(field){var query={range:{}};return query.range[field]={},{field:function(f){var oldValue=query.range[field];return null==f?field:(delete query.range[field],field=f,query.range[f]=oldValue,this)},from:function(f){return null==f?query.range[field].from:(query.range[field].from=f,this)},to:function(t){return null==t?query.range[field].to:(query.range[field].to=t,this)},includeLower:function(trueFalse){return null==trueFalse?query.range[field].include_lower:(query.range[field].include_lower=trueFalse,this)},includeUpper:function(trueFalse){return null==trueFalse?query.range[field].include_upper:(query.range[field].include_upper=trueFalse,this)},gt:function(val){return null==val?query.range[field].gt:(query.range[field].gt=val,this)},gte:function(val){return null==val?query.range[field].gte:(query.range[field].gte=val,this)},lt:function(val){return null==val?query.range[field].lt:(query.range[field].lt=val,this)},lte:function(val){return null==val?query.range[field].lte:(query.range[field].lte=val,this)},boost:function(boost){return null==boost?query.range[field].boost:(query.range[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.RegexpQuery=function(field,value){var query={regexp:{}};return query.regexp[field]={value:value},{field:function(f){var oldValue=query.regexp[field];return null==f?field:(delete query.regexp[field],field=f,query.regexp[f]=oldValue,this)},value:function(p){return null==p?query.regexp[field].value:(query.regexp[field].value=p,this)},flags:function(f){return null==f?query.regexp[field].flags:(query.regexp[field].flags=f,this)},flagsValue:function(v){return null==v?query.regexp[field].flags_value:(query.regexp[field].flags_value=v,this)},rewrite:function(m){return null==m?query.regexp[field].rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.regexp[field].rewrite=m),this)},boost:function(boost){return null==boost?query.regexp[field].boost:(query.regexp[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.SpanFirstQuery=function(spanQry,end){if(!isQuery(spanQry))throw new TypeError("Argument must be a SpanQuery");var query={span_first:{match:spanQry._self(),end:end}};return{match:function(spanQuery){if(null==spanQuery)return query.span_first.match;if(!isQuery(spanQuery))throw new TypeError("Argument must be a SpanQuery");return query.span_first.match=spanQuery._self(),this},end:function(position){return null==position?query.span_first.end:(query.span_first.end=position,this)},boost:function(boost){return null==boost?query.span_first.boost:(query.span_first.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.SpanMultiTermQuery=function(qry){if(null!=qry&&!isQuery(qry))throw new TypeError("Argument must be a MultiTermQuery");var query={span_multi:{match:{}}};return null!=qry&&(query.span_multi.match=qry._self()),{match:function(mtQuery){if(null==mtQuery)return query.span_multi.match;if(!isQuery(mtQuery))throw new TypeError("Argument must be a MultiTermQuery");return query.span_multi.match=mtQuery._self(),this},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.SpanNearQuery=function(clauses,slop){var i,len,query={span_near:{clauses:[],slop:slop}};if(isQuery(clauses))query.span_near.clauses.push(clauses._self());else{if(!isArray(clauses))throw new TypeError("Argument must be SpanQuery or array of SpanQueries");for(i=0,len=clauses.length;len>i;i++){if(!isQuery(clauses[i]))throw new TypeError("Argument must be array of SpanQueries");query.span_near.clauses.push(clauses[i]._self())}}return{clauses:function(clauses){var i,len;if(null==clauses)return query.span_near.clauses;if(isQuery(clauses))query.span_near.clauses.push(clauses._self());else{if(!isArray(clauses))throw new TypeError("Argument must be SpanQuery or array of SpanQueries");for(query.span_near.clauses=[],i=0,len=clauses.length;len>i;i++){if(!isQuery(clauses[i]))throw new TypeError("Argument must be array of SpanQueries");query.span_near.clauses.push(clauses[i]._self())}}return this},slop:function(distance){return null==distance?query.span_near.slop:(query.span_near.slop=distance,this)},inOrder:function(trueFalse){return null==trueFalse?query.span_near.in_order:(query.span_near.in_order=trueFalse,this)},collectPayloads:function(trueFalse){return null==trueFalse?query.span_near.collect_payloads:(query.span_near.collect_payloads=trueFalse,this)},boost:function(boost){return null==boost?query.span_near.boost:(query.span_near.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.SpanNotQuery=function(includeQry,excludeQry){if(!isQuery(includeQry)||!isQuery(excludeQry))throw new TypeError("Argument must be a SpanQuery");var query={span_not:{include:includeQry._self(),exclude:excludeQry._self()}};return{include:function(spanQuery){if(null==spanQuery)return query.span_not.include;if(!isQuery(spanQuery))throw new TypeError("Argument must be a SpanQuery");return query.span_not.include=spanQuery._self(),this},exclude:function(spanQuery){if(null==spanQuery)return query.span_not.exclude;if(!isQuery(spanQuery))throw new TypeError("Argument must be a SpanQuery");return query.span_not.exclude=spanQuery._self(),this},boost:function(boost){return null==boost?query.span_not.boost:(query.span_not.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.SpanOrQuery=function(clauses){var i,len,query={span_or:{clauses:[]}};if(isQuery(clauses))query.span_or.clauses.push(clauses._self());else{if(!isArray(clauses))throw new TypeError("Argument must be SpanQuery or array of SpanQueries");for(i=0,len=clauses.length;len>i;i++){if(!isQuery(clauses[i]))throw new TypeError("Argument must be array of SpanQueries");query.span_or.clauses.push(clauses[i]._self())}}return{clauses:function(clauses){var i,len;if(null==clauses)return query.span_or.clauses;if(isQuery(clauses))query.span_or.clauses.push(clauses._self());else{if(!isArray(clauses))throw new TypeError("Argument must be SpanQuery or array of SpanQueries");for(query.span_or.clauses=[],i=0,len=clauses.length;len>i;i++){if(!isQuery(clauses[i]))throw new TypeError("Argument must be array of SpanQueries");query.span_or.clauses.push(clauses[i]._self())}}return this},boost:function(boost){return null==boost?query.span_or.boost:(query.span_or.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.SpanTermQuery=function(field,value){var query={span_term:{}};return query.span_term[field]={term:value},{field:function(f){var oldValue=query.span_term[field];return null==f?field:(delete query.span_term[field],field=f,query.span_term[f]=oldValue,this)},term:function(t){return null==t?query.span_term[field].term:(query.span_term[field].term=t,this)},boost:function(boost){return null==boost?query.span_term[field].boost:(query.span_term[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.TermQuery=function(field,term){var query={term:{}};return query.term[field]={term:term},{field:function(f){var oldValue=query.term[field];return null==f?field:(delete query.term[field],field=f,query.term[f]=oldValue,this)},term:function(t){return null==t?query.term[field].term:(query.term[field].term=t,this)},boost:function(boost){return null==boost?query.term[field].boost:(query.term[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.TermsQuery=function(field,terms){var query={terms:{}};if(isString(terms))query.terms[field]=[terms];else{if(!isArray(terms))throw new TypeError("Argument must be string or array");query.terms[field]=terms}return{field:function(f){var oldValue=query.terms[field];return null==f?field:(delete query.terms[field],field=f,query.terms[f]=oldValue,this)},terms:function(t){if(null==t)return query.terms[field];if(isString(t))query.terms[field].push(t);else{if(!isArray(t))throw new TypeError("Argument must be string or array");query.terms[field]=t}return this},minimumShouldMatch:function(min){return null==min?query.terms.minimum_should_match:(query.terms.minimum_should_match=min,this)},disableCoord:function(trueFalse){return null==trueFalse?query.terms.disable_coord:(query.terms.disable_coord=trueFalse,this)},boost:function(boost){return null==boost?query.terms.boost:(query.terms.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.TopChildrenQuery=function(qry,type){if(!isQuery(qry))throw new TypeError("Argument must be a Query");var query={top_children:{query:qry._self(),type:type}};return{query:function(q){if(null==q)return query.top_children.query;if(!isQuery(q))throw new TypeError("Argument must be a Query");return query.top_children.query=q._self(),this},type:function(t){return null==t?query.top_children.type:(query.top_children.type=t,this)},scope:function(){return this},score:function(s){return null==s?query.top_children.score:(s=s.toLowerCase(),("max"===s||"sum"===s||"avg"===s||"total"===s)&&(query.top_children.score=s),this)},scoreMode:function(s){return null==s?query.top_children.score_mode:(s=s.toLowerCase(),("max"===s||"sum"===s||"avg"===s||"total"===s)&&(query.top_children.score_mode=s),this)},factor:function(f){return null==f?query.top_children.factor:(query.top_children.factor=f,this)},incrementalFactor:function(f){return null==f?query.top_children.incremental_factor:(query.top_children.incremental_factor=f,this)},boost:function(boost){return null==boost?query.top_children.boost:(query.top_children.boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.WildcardQuery=function(field,value){var query={wildcard:{}};return query.wildcard[field]={value:value},{field:function(f){var oldValue=query.wildcard[field];return null==f?field:(delete query.wildcard[field],field=f,query.wildcard[f]=oldValue,this)},value:function(v){return null==v?query.wildcard[field].value:(query.wildcard[field].value=v,this)},rewrite:function(m){return null==m?query.wildcard[field].rewrite:(m=m.toLowerCase(),("constant_score_auto"===m||"scoring_boolean"===m||"constant_score_boolean"===m||"constant_score_filter"===m||0===m.indexOf("top_terms_boost_")||0===m.indexOf("top_terms_"))&&(query.wildcard[field].rewrite=m),this)},boost:function(boost){return null==boost?query.wildcard[field].boost:(query.wildcard[field].boost=boost,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"query"},_self:function(){return query}}},ejs.ClusterHealth=function(){var params={},paramExcludes=["indices"];return{indices:function(i){if(null==params.indices&&(params.indices=[]),null==i)return params.indices;if(isString(i))params.indices.push(i);else{if(!isArray(i))throw new TypeError("Argument must be string or array");params.indices=i}return this},local:function(trueFalse){return null==trueFalse?params.local:(params.local=trueFalse,this)},masterTimeout:function(length){return null==length?params.master_timeout:(params.master_timeout=length,this)},timeout:function(length){return null==length?params.timeout:(params.timeout=length,this)},waitForStatus:function(status){return null==status?params.wait_for_status:(status=status.toLowerCase(),("green"===status||"yellow"===status||"red"===status)&&(params.wait_for_status=status),this)},waitForRelocatingShards:function(num){return null==num?params.wait_for_relocating_shards:(params.wait_for_relocating_shards=num,this)},waitForActiveShards:function(num){return null==num?params.wait_for_active_shards:(params.wait_for_active_shards=num,this)},waitForNodes:function(num){return null==num?params.wait_for_nodes:(params.wait_for_nodes=num,this)},level:function(l){return null==l?params.level:(l=l.toLowerCase(),("cluster"===l||"indices"===l||"shards"===l)&&(params.level=l),this)},toString:function(){return JSON.stringify(params)},_type:function(){return"cluster health"},_self:function(){return params},doHealth:function(successcb,errorcb){if(null==ejs.client)throw new Error("No Client Set");var url="/_cluster/health";return params.indices&&params.indices.length>0&&(url=url+"/"+params.indices.join()),ejs.client.get(url,genClientParams(params,paramExcludes),successcb,errorcb)}}},ejs.ClusterState=function(){var params={},paramExcludes=[];return{local:function(trueFalse){return null==trueFalse?params.local:(params.local=trueFalse,this)},masterTimeout:function(length){return null==length?params.master_timeout:(params.master_timeout=length,this)},filterNodes:function(trueFalse){return null==trueFalse?params.filter_nodes:(params.filter_nodes=trueFalse,this)},filterRoutingTable:function(trueFalse){return null==trueFalse?params.filter_routing_table:(params.filter_routing_table=trueFalse,this)},filterMetadata:function(trueFalse){return null==trueFalse?params.filter_metadata:(params.filter_metadata=trueFalse,this)},filterBlocks:function(trueFalse){return null==trueFalse?params.filter_blocks:(params.filter_blocks=trueFalse,this)},filterIndices:function(i){if(null==params.filter_indices&&(params.filter_indices=[]),null==i)return params.filter_indices;if(isString(i))params.filter_indices.push(i);else{if(!isArray(i))throw new TypeError("Argument must be string or array");params.filter_indices=i}return this},filterIndexTemplates:function(i){if(null==params.filter_index_templates&&(params.filter_index_templates=[]),null==i)return params.filter_index_templates;if(isString(i))params.filter_index_templates.push(i);else{if(!isArray(i))throw new TypeError("Argument must be string or array");params.filter_index_templates=i}return this},toString:function(){return JSON.stringify(params)},_type:function(){return"cluster state"},_self:function(){return params},doState:function(successcb,errorcb){if(null==ejs.client)throw new Error("No Client Set");var url="/_cluster/state";return ejs.client.get(url,genClientParams(params,paramExcludes),successcb,errorcb)}}},ejs.NodeInfo=function(){var params={},paramExcludes=["nodes"];return{nodes:function(n){if(null==params.nodes&&(params.nodes=[]),null==n)return params.nodes;if(isString(n))params.nodes.push(n);else{if(!isArray(n))throw new TypeError("Argument must be string or array");params.nodes=n}return this},clear:function(trueFalse){return null==trueFalse?params.clear:(params.clear=trueFalse,this)},all:function(trueFalse){return null==trueFalse?params.all:(params.all=trueFalse,this)},settings:function(trueFalse){return null==trueFalse?params.settings:(params.settings=trueFalse,this)},os:function(trueFalse){return null==trueFalse?params.os:(params.os=trueFalse,this)},process:function(trueFalse){return null==trueFalse?params.process:(params.process=trueFalse,this)},jvm:function(trueFalse){return null==trueFalse?params.jvm:(params.jvm=trueFalse,this)},threadPool:function(trueFalse){return null==trueFalse?params.thread_pool:(params.thread_pool=trueFalse,this)},network:function(trueFalse){return null==trueFalse?params.network:(params.network=trueFalse,this)},transport:function(trueFalse){return null==trueFalse?params.transport:(params.transport=trueFalse,this)},http:function(trueFalse){return null==trueFalse?params.http:(params.http=trueFalse,this)},plugin:function(trueFalse){return null==trueFalse?params.plugin:(params.plugin=trueFalse,this)},timeout:function(length){return null==length?params.timeout:(params.timeout=length,this)},toString:function(){return JSON.stringify(params)},_type:function(){return"node info"},_self:function(){return params},doInfo:function(successcb,errorcb){if(null==ejs.client)throw new Error("No Client Set");var url="/_nodes";return params.nodes&&params.nodes.length>0&&(url=url+"/"+params.nodes.join()),ejs.client.get(url,genClientParams(params,paramExcludes),successcb,errorcb)}}},ejs.NodeStats=function(){var params={},paramExcludes=["nodes"];return{nodes:function(n){if(null==params.nodes&&(params.nodes=[]),null==n)return params.nodes;if(isString(n))params.nodes.push(n);else{if(!isArray(n))throw new TypeError("Argument must be string or array");params.nodes=n}return this},clear:function(trueFalse){return null==trueFalse?params.clear:(params.clear=trueFalse,this)},all:function(trueFalse){return null==trueFalse?params.all:(params.all=trueFalse,this)},indices:function(trueFalse){return null==trueFalse?params.indices:(params.indices=trueFalse,this)},os:function(trueFalse){return null==trueFalse?params.os:(params.os=trueFalse,this)},process:function(trueFalse){return null==trueFalse?params.process:(params.process=trueFalse,this)},jvm:function(trueFalse){return null==trueFalse?params.jvm:(params.jvm=trueFalse,this)},threadPool:function(trueFalse){return null==trueFalse?params.thread_pool:(params.thread_pool=trueFalse,this)},network:function(trueFalse){return null==trueFalse?params.network:(params.network=trueFalse,this)},fs:function(trueFalse){return null==trueFalse?params.fs:(params.fs=trueFalse,this)},transport:function(trueFalse){return null==trueFalse?params.transport:(params.transport=trueFalse,this)},http:function(trueFalse){return null==trueFalse?params.http:(params.http=trueFalse,this)},toString:function(){return JSON.stringify(params)},_type:function(){return"node stats"},_self:function(){return params},doStats:function(successcb,errorcb){if(null==ejs.client)throw new Error("No Client Set");var url="/_nodes";return params.nodes&&params.nodes.length>0&&(url=url+"/"+params.nodes.join()),url+="/stats",ejs.client.get(url,genClientParams(params,paramExcludes),successcb,errorcb)}}},ejs.GeoPoint=function(p){var point=[0,0];return null!=p&&isArray(p)&&2===p.length&&(point=[p[1],p[0]]),{properties:function(obj){return null==obj?point:(isObject(obj)&&has(obj,"lat")&&has(obj,"lon")?point={lat:obj.lat,lon:obj.lon}:isObject(obj)&&has(obj,"geohash")&&(point={geohash:obj.geohash}),this)},string:function(s){return null==s?point:(isString(s)&&-1!==s.indexOf(",")&&(point=s),this)},geohash:function(hash,precision){return precision=null!=precision&&isNumber(precision)?precision:12,null==hash?point:(isString(hash)&&hash.length===precision&&(point=hash),this)},array:function(a){return null==a?point:(isArray(a)&&2===a.length&&(point=[a[1],a[0]]),this)},toString:function(){return JSON.stringify(point)},_type:function(){return"geo point"},_self:function(){return point}}},ejs.Highlight=function(fields){var highlight={fields:{}},addOption=function(field,option,val){null==field?highlight[option]=val:(has(highlight.fields,field)||(highlight.fields[field]={}),highlight.fields[field][option]=val)};return null!=fields&&(isString(fields)?highlight.fields[fields]={}:isArray(fields)&&each(fields,function(field){highlight.fields[field]={}})),{fields:function(vals){return null==vals?highlight.fields:(isString(vals)?has(highlight.fields,vals)||(highlight.fields[vals]={}):isArray(vals)&&each(vals,function(field){has(highlight.fields,field)||(highlight.fields[field]={})}),void 0)},preTags:function(tags,oField){return null===tags&&null!=oField?highlight.fields[oField].pre_tags:null==tags?highlight.pre_tags:(isString(tags)?addOption(oField,"pre_tags",[tags]):isArray(tags)&&addOption(oField,"pre_tags",tags),this)},postTags:function(tags,oField){return null===tags&&null!=oField?highlight.fields[oField].post_tags:null==tags?highlight.post_tags:(isString(tags)?addOption(oField,"post_tags",[tags]):isArray(tags)&&addOption(oField,"post_tags",tags),this)},order:function(o,oField){return null===o&&null!=oField?highlight.fields[oField].order:null==o?highlight.order:(o=o.toLowerCase(),"score"===o&&addOption(oField,"order",o),this)},tagsSchema:function(s){return null==s?highlight.tags_schema:(s=s.toLowerCase(),"styled"===s&&(highlight.tags_schema=s),this)},highlightFilter:function(trueFalse,oField){return null===trueFalse&&null!=oField?highlight.fields[oField].highlight_filter:null==trueFalse?highlight.highlight_filter:(addOption(oField,"highlight_filter",trueFalse),this)},fragmentSize:function(size,oField){return null===size&&null!=oField?highlight.fields[oField].fragment_size:null==size?highlight.fragment_size:(addOption(oField,"fragment_size",size),this)},numberOfFragments:function(cnt,oField){return null===cnt&&null!=oField?highlight.fields[oField].number_of_fragments:null==cnt?highlight.number_of_fragments:(addOption(oField,"number_of_fragments",cnt),this)},encoder:function(e){return null==e?highlight.encoder:(e=e.toLowerCase(),("default"===e||"html"===e)&&(highlight.encoder=e),this)},requireFieldMatch:function(trueFalse,oField){return null===trueFalse&&null!=oField?highlight.fields[oField].require_field_match:null==trueFalse?highlight.require_field_match:(addOption(oField,"require_field_match",trueFalse),this)},boundaryMaxScan:function(cnt,oField){return null===cnt&&null!=oField?highlight.fields[oField].boundary_max_scan:null==cnt?highlight.boundary_max_scan:(addOption(oField,"boundary_max_scan",cnt),this)},boundaryChars:function(charStr,oField){return null===charStr&&null!=oField?highlight.fields[oField].boundary_chars:null==charStr?highlight.boundary_chars:(addOption(oField,"boundary_chars",charStr),this)},type:function(t,oField){return null===t&&null!=oField?highlight.fields[oField].type:null==t?highlight.type:(t=t.toLowerCase(),("fast-vector-highlighter"===t||"highlighter"===t)&&addOption(oField,"type",t),this)},fragmenter:function(f,oField){return null===f&&null!=oField?highlight.fields[oField].fragmenter:null==f?highlight.fragmenter:(f=f.toLowerCase(),("simple"===f||"span"===f)&&addOption(oField,"fragmenter",f),this)},options:function(opts,oField){if(null===opts&&null!=oField)return highlight.fields[oField].options;if(null==opts)return highlight.options;if(!isObject(opts)||isArray(opts)||isEJSObject(opts))throw new TypeError("Parameter must be an object");return addOption(oField,"options",opts),this},toString:function(){return JSON.stringify(highlight)},_type:function(){return"highlight"},_self:function(){return highlight}}},ejs.IndexedShape=function(type,id){var indexedShape={type:type,id:id};return{type:function(t){return null==t?indexedShape.type:(indexedShape.type=t,this)},id:function(id){return null==id?indexedShape.id:(indexedShape.id=id,this)},index:function(idx){return null==idx?indexedShape.index:(indexedShape.index=idx,this)},shapeFieldName:function(field){return null==field?indexedShape.shape_field_name:(indexedShape.shape_field_name=field,this)},toString:function(){return JSON.stringify(indexedShape)},_type:function(){return"indexed shape"},_self:function(){return indexedShape}}},ejs.MultiSearchRequest=function(conf){var requests,indices,types,params={},getRestPath=function(){var searchUrl="",parts=[];indices.length>0&&(searchUrl=searchUrl+"/"+indices.join()),types.length>0&&(searchUrl=searchUrl+"/"+types.join()),searchUrl+="/_msearch";for(var p in params)has(params,p)&&""!==params[p]&&parts.push(p+"="+encodeURIComponent(params[p]));return parts.length>0&&(searchUrl=searchUrl+"?"+parts.join("&")),searchUrl};return requests=[],conf=conf||{},indices=null==conf.indices?[]:isString(conf.indices)?[conf.indices]:conf.indices,types=null==conf.types?[]:isString(conf.types)?[conf.types]:conf.types,0===indices.length&&types.length>0&&(indices=["_all"]),{requests:function(r){if(null==r)return requests;if(isRequest(r))requests.push(r);else{if(!isArray(r))throw new TypeError("Argument must be request or array");requests=r}return this},searchType:function(t){return null==t?params.search_type:(t=t.toLowerCase(),("dfs_query_then_fetch"===t||"dfs_query_and_fetch"===t||"query_then_fetch"===t||"query_and_fetch"===t||"scan"===t||"count"===t)&&(params.search_type=t),this)},indices:function(indexArray){if(null==indexArray)return indices;if(isString(indexArray))indices=[indexArray];else{if(!isArray(indexArray))throw new TypeError("Argument must be a string or array");indices=indexArray}return 0===indices.length&&types.length>0&&(indices=["_all"]),this},types:function(typeArray){if(null==typeArray)return types;if(isString(typeArray))types=[typeArray];else{if(!isArray(typeArray))throw new TypeError("Argument must be a string or array");types=typeArray}return 0===indices.length&&types.length>0&&(indices=["_all"]),this},ignoreIndices:function(ignoreType){return null==ignoreType?params.ignore_indices:(ignoreType=ignoreType.toLowerCase(),("none"===ignoreType||"missing"===ignoreType)&&(params.ignore_indices=ignoreType),this)},toString:function(){var i,len,reqs=[];for(i=0,len=requests.length;len>i;i++)reqs.push(requests[i]._self());return JSON.stringify(reqs)},_type:function(){return"multi search request"},_self:function(){var i,len,reqs=[];for(i=0,len=requests.length;len>i;i++)reqs.push(requests[i]._self());return reqs},doSearch:function(successcb,errorcb){var i,len,request,query,header,data="";if(null==ejs.client)throw new Error("No Client Set");for(i=0,len=requests.length;len>i;i++)request=requests[i],header={},request.indices().length>0&&(header.indices=request.indices()),request.types().length>0&&(header.types=request.types()),null!=request.searchType()&&(header.search_type=request.searchType()),null!=request.preference()&&(header.preference=request.preference()),null!=request.routing()&&(header.routing=request.routing()),null!=request.ignoreIndices()&&(header.ignore_indices=request.ignoreIndices()),data=data+JSON.stringify(header)+"\n",query=request._self(),null!=request.timeout()&&(query.timeout=request.timeout()),data=data+JSON.stringify(query)+"\n";return ejs.client.post(getRestPath(),data,successcb,errorcb)}}},ejs.Request=function(conf){var query,indices,types,params={},getRestPath=function(endpoint){var searchUrl="",parts=[];indices.length>0&&(searchUrl=searchUrl+"/"+indices.join()),types.length>0&&(searchUrl=searchUrl+"/"+types.join()),endpoint.length>0&&"/"!==endpoint[0]&&(searchUrl+="/"),searchUrl+=endpoint;for(var p in params)has(params,p)&&""!==params[p]&&parts.push(p+"="+encodeURIComponent(params[p]));return parts.length>0&&(searchUrl=searchUrl+"?"+parts.join("&")),searchUrl};return query={},conf=conf||{},indices=null==conf.indices?[]:isString(conf.indices)?[conf.indices]:conf.indices,types=null==conf.types?[]:isString(conf.types)?[conf.types]:conf.types,0===indices.length&&types.length>0&&(indices=["_all"]),null!=conf.routing&&(params.routing=conf.routing),{sort:function(){var i,len;if(has(query,"sort")||(query.sort=[]),0===arguments.length)return query.sort;if(1===arguments.length){var sortVal=arguments[0];if(isString(sortVal))query.sort.push(sortVal);else if(isSort(sortVal))query.sort.push(sortVal._self());else{if(!isArray(sortVal))throw new TypeError("Argument must be string, Sort, or array");for(query.sort=[],i=0,len=sortVal.length;len>i;i++)if(isString(sortVal[i]))query.sort.push(sortVal[i]);else{if(!isSort(sortVal[i]))throw new TypeError("Invalid object in array");query.sort.push(sortVal[i]._self())}}}else if(2===arguments.length){var field=arguments[0],order=arguments[1];if(isString(field)&&isString(order)&&(order=order.toLowerCase(),"asc"===order||"desc"===order)){var sortObj={};sortObj[field]={order:order},query.sort.push(sortObj)}}return this},trackScores:function(trueFalse){return null==trueFalse?query.track_scores:(query.track_scores=trueFalse,this)},size:function(s){return null==s?query.size:(query.size=s,this)},timeout:function(t){return null==t?params.timeout:(params.timeout=t,this)},routing:function(route){return null==route?params.routing:(params.routing=route,this)},replication:function(r){return null==r?params.replication:(r=r.toLowerCase(),("async"===r||"sync"===r||"default"===r)&&(params.replication=r),this)},consistency:function(c){return null==c?params.consistency:(c=c.toLowerCase(),("default"===c||"one"===c||"quorum"===c||"all"===c)&&(params.consistency=c),this)},searchType:function(t){return null==t?params.search_type:(t=t.toLowerCase(),("dfs_query_then_fetch"===t||"dfs_query_and_fetch"===t||"query_then_fetch"===t||"query_and_fetch"===t||"scan"===t||"count"===t)&&(params.search_type=t),this)},fields:function(fieldList){if(null==fieldList)return query.fields;if(null==query.fields&&(query.fields=[]),isString(fieldList))query.fields.push(fieldList);else{if(!isArray(fieldList))throw new TypeError("Argument must be string or array");query.fields=fieldList}return this},rescore:function(r){if(null==r)return query.rescore;if(!isRescore(r))throw new TypeError("Argument must be a Rescore");return query.rescore=r._self(),this},from:function(f){return null==f?query.from:(query.from=f,this)},query:function(someQuery){if(null==someQuery)return query.query;if(!isQuery(someQuery))throw new TypeError("Argument must be a Query");return query.query=someQuery._self(),this},indices:function(indexArray){if(null==indexArray)return indices;if(isString(indexArray))indices=[indexArray];else{if(!isArray(indexArray))throw new TypeError("Argument must be a string or array");indices=indexArray}return 0===indices.length&&types.length>0&&(indices=["_all"]),this},types:function(typeArray){if(null==typeArray)return types;if(isString(typeArray))types=[typeArray];else{if(!isArray(typeArray))throw new TypeError("Argument must be a string or array");types=typeArray}return 0===indices.length&&types.length>0&&(indices=["_all"]),this},facet:function(facet){if(null==facet)return query.facets;if(null==query.facets&&(query.facets={}),!isFacet(facet))throw new TypeError("Argument must be a Facet");return extend(query.facets,facet._self()),this},filter:function(filter){if(null==filter)return query.filter;
if(!isFilter(filter))throw new TypeError("Argument must be a Filter");return query.filter=filter._self(),this},highlight:function(h){if(null==h)return query.highlight;if(!isHighlight(h))throw new TypeError("Argument must be a Highlight object");return query.highlight=h._self(),this},suggest:function(s){if(null==s)return query.suggest;if(null==query.suggest&&(query.suggest={}),isString(s))query.suggest.text=s;else{if(!isSuggest(s))throw new TypeError("Argument must be a string or Suggest object");extend(query.suggest,s._self())}return this},scriptField:function(oScriptField){if(null==oScriptField)return query.script_fields;if(null==query.script_fields&&(query.script_fields={}),!isScriptField(oScriptField))throw new TypeError("Argument must be a ScriptField");return extend(query.script_fields,oScriptField._self()),this},preference:function(perf){return null==perf?params.preference:(params.preference=perf,this)},local:function(trueFalse){return null==trueFalse?params.local:(params.local=trueFalse,this)},ignoreIndices:function(ignoreType){return null==ignoreType?params.ignore_indices:(ignoreType=ignoreType.toLowerCase(),("none"===ignoreType||"missing"===ignoreType)&&(params.ignore_indices=ignoreType),this)},indexBoost:function(index,boost){return null==query.indices_boost&&(query.indices_boost={}),0===arguments.length?query.indices_boost:(query.indices_boost[index]=boost,this)},explain:function(trueFalse){return null==trueFalse?query.explain:(query.explain=trueFalse,this)},version:function(trueFalse){return null==trueFalse?query.version:(query.version=trueFalse,this)},minScore:function(min){return null==min?query.min_score:(query.min_score=min,this)},toString:function(){return JSON.stringify(query)},_type:function(){return"request"},_self:function(){return query},doDeleteByQuery:function(successcb,errorcb){var queryData=JSON.stringify(query.query);if(null==ejs.client)throw new Error("No Client Set");return ejs.client.del(getRestPath("_query"),queryData,successcb,errorcb)},doCount:function(successcb,errorcb){var queryData=JSON.stringify(query.query);if(null==ejs.client)throw new Error("No Client Set");return ejs.client.post(getRestPath("_count"),queryData,successcb,errorcb)},doSearch:function(successcb,errorcb){var queryData=JSON.stringify(query);if(null==ejs.client)throw new Error("No Client Set");return ejs.client.post(getRestPath("_search"),queryData,successcb,errorcb)},doSearchShards:function(successcb,errorcb){if(null==ejs.client)throw new Error("No Client Set");return ejs.client.post(getRestPath("_search_shards"),"",successcb,errorcb)}}},ejs.Rescore=function(windowSize,qry){if(null!=windowSize&&!isNumber(windowSize))throw new TypeError("Argument must be a Number");if(null!=qry&&!isQuery(qry))throw new TypeError("Argument must be a Query");var rescore={query:{}};return null!=windowSize&&(rescore.window_size=windowSize),null!=qry&&(rescore.query.rescore_query=qry._self()),{rescoreQuery:function(someQuery){if(null==someQuery)return rescore.query.rescore_query;if(!isQuery(someQuery))throw new TypeError("Argument must be a Query");return rescore.query.rescore_query=someQuery._self(),this},queryWeight:function(weight){if(null==weight)return rescore.query.query_weight;if(!isNumber(weight))throw new TypeError("Argument must be a Number");return rescore.query.query_weight=weight,this},rescoreQueryWeight:function(weight){if(null==weight)return rescore.query.rescore_query_weight;if(!isNumber(weight))throw new TypeError("Argument must be a Number");return rescore.query.rescore_query_weight=weight,this},windowSize:function(size){if(null==size)return rescore.window_size;if(!isNumber(size))throw new TypeError("Argument must be a Number");return rescore.window_size=size,this},scoreMode:function(s){return null==s?rescore.query.score_mode:(s=s.toLowerCase(),("total"===s||"min"===s||"max"===s||"multiply"===s||"avg"===s)&&(rescore.query.score_mode=s),this)},toString:function(){return JSON.stringify(rescore)},_type:function(){return"rescore"},_self:function(){return rescore}}},ejs.ScriptField=function(fieldName){var script={};return script[fieldName]={},{lang:function(language){return null==language?script[fieldName].lang:(script[fieldName].lang=language,this)},script:function(expression){return null==expression?script[fieldName].script:(script[fieldName].script=expression,this)},params:function(oParams){return null==oParams?script[fieldName].params:(script[fieldName].params=oParams,this)},ignoreFailure:function(trueFalse){return null==trueFalse?script[fieldName].ignore_failure:(script[fieldName].ignore_failure=trueFalse,this)},toString:function(){return JSON.stringify(script)},_type:function(){return"script field"},_self:function(){return script}}},ejs.Shape=function(type,coords){var shape={},validType=function(t){var valid=!1;return("point"===t||"linestring"===t||"polygon"===t||"multipoint"===t||"envelope"===t||"multipolygon"===t||"circle"===t||"multilinestring"===t)&&(valid=!0),valid};return type=type.toLowerCase(),validType(type)&&(shape.type=type,shape.coordinates=coords),{type:function(t){return null==t?shape.type:(t=t.toLowerCase(),validType(t)&&(shape.type=t),this)},coordinates:function(c){return null==c?shape.coordinates:(shape.coordinates=c,this)},radius:function(r){return null==r?shape.radius:(shape.radius=r,this)},toString:function(){return JSON.stringify(shape)},_type:function(){return"shape"},_self:function(){return shape}}},ejs.Sort=function(fieldName){null==fieldName&&(fieldName="_score");var sort={},key=fieldName,geo_key="_geo_distance",script_key="_script";return sort[key]={},{field:function(f){var oldValue=sort[key];return null==f?fieldName:(delete sort[key],fieldName=f,key=f,sort[key]=oldValue,this)},geoDistance:function(point){var oldValue=sort[key];if(null==point)return sort[key][fieldName];if(!isGeoPoint(point))throw new TypeError("Argument must be a GeoPoint");return delete sort[key],key=geo_key,sort[key]=oldValue,sort[key][fieldName]=point._self(),this},script:function(scriptCode){var oldValue=sort[key];return null==scriptCode?sort[key].script:(delete sort[key],key=script_key,sort[key]=oldValue,sort[key].script=scriptCode,this)},order:function(o){return null==o?sort[key].order:(o=o.toLowerCase(),("asc"===o||"desc"===o)&&(sort[key].order=o),this)},asc:function(){return sort[key].order="asc",this},desc:function(){return sort[key].order="desc",this},reverse:function(trueFalse){return null==trueFalse?sort[key].reverse:(sort[key].reverse=trueFalse,this)},missing:function(m){return null==m?sort[key].missing:(sort[key].missing=m,this)},ignoreUnmapped:function(trueFalse){return null==trueFalse?sort[key].ignore_unmapped:(sort[key].ignore_unmapped=trueFalse,this)},unit:function(unit){return null==unit?sort[key].unit:(unit=unit.toLowerCase(),("mi"===unit||"km"===unit)&&(sort[key].unit=unit),this)},normalize:function(trueFalse){return null==trueFalse?sort[key].normalize:(sort[key].normalize=trueFalse,this)},distanceType:function(type){return null==type?sort[key].distance_type:(type=type.toLowerCase(),("arc"===type||"plane"===type)&&(sort[key].distance_type=type),this)},params:function(p){return null==p?sort[key].params:(sort[key].params=p,this)},lang:function(lang){return null==lang?sort[key].lang:(sort[key].lang=lang,this)},type:function(type){return null==type?sort[key].type:(type=type.toLowerCase(),("string"===type||"number"===type)&&(sort[key].type=type),this)},mode:function(m){return null==m?sort[key].mode:(m=m.toLowerCase(),("min"===m||"max"===m||"sum"===m||"avg"===m)&&(sort[key].mode=m),this)},nestedPath:function(path){return null==path?sort[key].nested_path:(sort[key].nested_path=path,this)},nestedFilter:function(oFilter){if(null==oFilter)return sort[key].nested_filter;if(!isFilter(oFilter))throw new TypeError("Argument must be a Filter");return sort[key].nested_filter=oFilter._self(),this},toString:function(){return JSON.stringify(sort)},_type:function(){return"sort"},_self:function(){return sort}}},ejs.DirectGenerator=function(){var _common=ejs.DirectSettingsMixin(),generator=_common._self();return extend(_common,{preFilter:function(analyzer){return null==analyzer?generator.pre_filter:(generator.pre_filter=analyzer,this)},postFilter:function(analyzer){return null==analyzer?generator.post_filter:(generator.post_filter=analyzer,this)},field:function(field){return null==field?generator.field:(generator.field=field,this)},size:function(s){return null==s?generator.size:(generator.size=s,this)},toString:function(){return JSON.stringify(generator)},_type:function(){return"generator"},_self:function(){return generator}})},ejs.DirectSettingsMixin=function(){var settings={};return{accuracy:function(a){return null==a?settings.accuracy:(settings.accuracy=a,this)},suggestMode:function(m){return null==m?settings.suggest_mode:(m=m.toLowerCase(),("missing"===m||"popular"===m||"always"===m)&&(settings.suggest_mode=m),this)},sort:function(s){return null==s?settings.sort:(s=s.toLowerCase(),("score"===s||"frequency"===s)&&(settings.sort=s),this)},stringDistance:function(s){return null==s?settings.string_distance:(s=s.toLowerCase(),("internal"===s||"damerau_levenshtein"===s||"levenstein"===s||"jarowinkler"===s||"ngram"===s)&&(settings.string_distance=s),this)},maxEdits:function(max){return null==max?settings.max_edits:(settings.max_edits=max,this)},maxInspections:function(max){return null==max?settings.max_inspections:(settings.max_inspections=max,this)},maxTermFreq:function(max){return null==max?settings.max_term_freq:(settings.max_term_freq=max,this)},prefixLen:function(len){return null==len?settings.prefix_len:(settings.prefix_len=len,this)},minWordLen:function(len){return null==len?settings.min_word_len:(settings.min_word_len=len,this)},minDocFreq:function(min){return null==min?settings.min_doc_freq:(settings.min_doc_freq=min,this)},_self:function(){return settings}}},ejs.PhraseSuggester=function(name){var suggest={};return suggest[name]={phrase:{}},{text:function(txt){return null==txt?suggest[name].text:(suggest[name].text=txt,this)},analyzer:function(analyzer){return null==analyzer?suggest[name].phrase.analyzer:(suggest[name].phrase.analyzer=analyzer,this)},field:function(field){return null==field?suggest[name].phrase.field:(suggest[name].phrase.field=field,this)},size:function(s){return null==s?suggest[name].phrase.size:(suggest[name].phrase.size=s,this)},shardSize:function(s){return null==s?suggest[name].phrase.shard_size:(suggest[name].phrase.shard_size=s,this)},realWorldErrorLikelihood:function(l){return null==l?suggest[name].phrase.real_world_error_likelihood:(suggest[name].phrase.real_world_error_likelihood=l,this)},confidence:function(c){return null==c?suggest[name].phrase.confidence:(suggest[name].phrase.confidence=c,this)},separator:function(sep){return null==sep?suggest[name].phrase.separator:(suggest[name].phrase.separator=sep,this)},maxErrors:function(max){return null==max?suggest[name].phrase.max_errors:(suggest[name].phrase.max_errors=max,this)},gramSize:function(s){return null==s?suggest[name].phrase.gram_size:(suggest[name].phrase.gram_size=s,this)},forceUnigrams:function(trueFalse){return null==trueFalse?suggest[name].phrase.force_unigrams:(suggest[name].phrase.force_unigrams=trueFalse,this)},tokenLimit:function(l){return null==l?suggest[name].phrase.token_limit:(suggest[name].phrase.token_limit=l,this)},linearSmoothing:function(tl,bl,ul){return 0===arguments.length?suggest[name].phrase.smoothing:(suggest[name].phrase.smoothing={linear:{trigram_lambda:tl,bigram_lambda:bl,unigram_lambda:ul}},this)},laplaceSmoothing:function(alpha){return null==alpha?suggest[name].phrase.smoothing:(suggest[name].phrase.smoothing={laplace:{alpha:alpha}},this)},stupidBackoffSmoothing:function(discount){return null==discount?suggest[name].phrase.smoothing:(suggest[name].phrase.smoothing={stupid_backoff:{discount:discount}},this)},highlight:function(preTag,postTag){return 0===arguments.length?suggest[name].phrase.highlight:(suggest[name].phrase.highlight={pre_tag:preTag,post_tag:postTag},this)},directGenerator:function(oGenerator){var i,len;if(null==suggest[name].phrase.direct_generator&&(suggest[name].phrase.direct_generator=[]),null==oGenerator)return suggest[name].phrase.direct_generator;if(isGenerator(oGenerator))suggest[name].phrase.direct_generator.push(oGenerator._self());else{if(!isArray(oGenerator))throw new TypeError("Argument must be a Generator or array of Generators");for(suggest[name].phrase.direct_generator=[],i=0,len=oGenerator.length;len>i;i++){if(!isGenerator(oGenerator[i]))throw new TypeError("Argument must be an array of Generators");suggest[name].phrase.direct_generator.push(oGenerator[i]._self())}}return this},toString:function(){return JSON.stringify(suggest)},_type:function(){return"suggest"},_self:function(){return suggest}}},ejs.TermSuggester=function(name){var suggest={},_common=ejs.DirectSettingsMixin();return suggest[name]={term:_common._self()},extend(_common,{text:function(txt){return null==txt?suggest[name].text:(suggest[name].text=txt,this)},analyzer:function(analyzer){return null==analyzer?suggest[name].term.analyzer:(suggest[name].term.analyzer=analyzer,this)},field:function(field){return null==field?suggest[name].term.field:(suggest[name].term.field=field,this)},size:function(s){return null==s?suggest[name].term.size:(suggest[name].term.size=s,this)},shardSize:function(s){return null==s?suggest[name].term.shard_size:(suggest[name].term.shard_size=s,this)},toString:function(){return JSON.stringify(suggest)},_type:function(){return"suggest"},_self:function(){return suggest}})},ejs.noConflict=function(){return root.ejs=_ejs,this}}).call(this);