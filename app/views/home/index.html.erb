<% content_for :javascript do %>
    <%= stylesheet_link_tag    "nanoscroller.css", :media => "all" %>
    <%= javascript_include_tag "closed-event-overlay" %>
    <%= javascript_include_tag "jquery.nanoscroller.min" %>

    <script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script>
      var map;
      var marker;
      var myLatlng = new google.maps.LatLng(17.432259,78.407529);

      function initialize() {
        var mapOptions = {
          zoom: 11,
          center: myLatlng,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          styles: [
          {
             featureType: 'all',
             elementType: 'all',
             stylers: [
               { visibility: "on" },
               // Increase to -100 to remove all color
               { saturation: -80 }
            ]
          }]
        };

        map = new google.maps.Map(document.getElementById('map_canvas'),
            mapOptions);

        var contentString = '<div id="content">'+
            '<div id="siteNotice">'+
            '</div>'+
            '<h2 id="firstHeading" class="firstHeading">Via Milano </h2>'+
            '<div id="bodyContent">'+
            '<p><b>Uluru</b>, also referred to as <b>Ayers Rock</b>, is a large ' +
            'sandstone rock formation in the southern part of the '+
            'Northern Territory, central Australia. It lies 335 km (208 mi) '+
            'south west of the nearest large town, Alice Springs; 450 km '+
            '(280 mi) by road. Kata Tjuta and Uluru are the two major '+
            'features of the Uluru - Kata Tjuta National Park. Uluru is '+
            'sacred to the Pitjantjatjara and Yankunytjatjara, the '+
            'Aboriginal people of the area. It has many springs, waterholes, '+
            'rock caves and ancient paintings. Uluru is listed as a World '+
            'Heritage Site.</p>'+
            '<p>Attribution: Uluru, <a href="http://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">'+
            'http://en.wikipedia.org/w/index.php?title=Uluru</a> (last visited June 22, 2009).</p>'+
            '</div>'+
            '</div>';

        var infowindow = new google.maps.InfoWindow({
            content: contentString
        });

        marker = new google.maps.Marker({
            position: myLatlng,
            map: map,
            title: 'Hello World!'
        });

        google.maps.event.addListener(marker, 'click', function() {
          infowindow.open(map,marker);
        });
      }

      google.maps.event.addDomListener(window, 'load', initialize);


    </script>

<% end %>

<% content_for :homepageHeader do %>
    
         <div class="row">
          <div class="col-md-8 col-md-offset-2">
            <h4 class="topBarText">
              Meet <span class="topBarTextHighlight">great people</span> over <span class="topBarTextHighlight">great food.</span>
            </h4>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 col-md-offset-3">
            <div class="topBarButtons">
              <a href="<%= user_omniauth_authorize_path(:facebook) %>" class="css3-button css3-button_blue facebookLoginButton">
                Sign up with 
                <%= image_tag("facebookLogo.png")%>
              </a>  
              <a href="<%= new_user_registration_path %>" class="css3-button css3-button_pink facebookLoginButton">
                Sign up with email
              </a>
            </div>
            
          </div>
        </div>
    

<% end %>

<div id="map_canvas" style="width: 100%; height: 300px;background: #ccc; border-bottom:4px solid #333;"></div>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <%= render 'layouts/messages' %>
        </div>
    </div>
</div>



<div class="filter">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div id="citySelect">
                  Select your city
                  <i class="icon-angle-down pull-right"></i>
                </div>

                <div id="cityList" class="hidden_div">
                  <div class="nano">
                  <div class="content"> 
                    <ul>
                      <li>
                        <strong>India</strong>
                        <ul>
                          <li>Ahmedabad</li>
                          <li>Bangalore</li>
                          <li>Hyderabad</li>
                          <li>Pune</li>
                        </ul>
                      </li>
                      <li>
                        <strong>Malaysia</strong>
                        <ul>
                          <li>Kuala Lumpur</li>
                          <li>Penang</li>
                          <li>Perak</li>
                          <li>Selangor</li>
                        </ul>
                      </li>
                    </ul>
                  </div>
                  
                  </div>
                </div>
                
            </div>
        </div>
    </div>
</div>



<div class="container">
    <div class="row-fluid">
        <div class="span12">
            <%# Adding the city name to the title i.e. the page title should read city name events eg. Hyderabad events %>
            
            <% if session[:city].nil? %>
                <% session[:city] = "" %>
            <% end %>

            
            <% if session[:city].empty? %>
                <h1>Events</h1>    
            <% else %>
                <h1><%= session[:city] %> Events</h1>
            <% end %>   
            
        </div>
    </div>
</div>

<%= render partial: 'events/event_list',  :locals => {:events => @events} %>

<script>
  $(".nano").nanoScroller();
</script>

<script>
  $(document).ready(function(){
    $(document).mouseup(function (e)
    {
        var container = $("#cityList");
        if (container.has(e.target).length === 0)
        {
          container.addClass('hidden_div');
        }
      });
    
    $('#citySelect').click(function(){
      $('#cityList').removeClass('hidden_div');
      $('#cityList .content ul ul li').click(function(e){
        var citySelected = $(this).text();
        var url = window.location.pathname
        var url_to_submit_to = '/'+citySelected;
        window.location = url_to_submit_to;
      });
    });
  });
</script>