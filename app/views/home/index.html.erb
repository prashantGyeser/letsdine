<% content_for :javascript do %>
    <%= stylesheet_link_tag    "nanoscroller.css", :media => "all" %>
    <%= javascript_include_tag "closed-event-overlay" %>
    <%= javascript_include_tag "jquery.nanoscroller.min" %>

   <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
var infowindow = null;
    $(document).ready(function () { initialize();  });

    function initialize() {

        var centerMap = new google.maps.LatLng(39.828175, -98.5795);

        var myOptions = {
            zoom: 4,
            center: centerMap,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }

        var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

        setMarkers(map, sites);
      infowindow = new google.maps.InfoWindow({
                content: "loading..."
            });

        var bikeLayer = new google.maps.BicyclingLayer();
    bikeLayer.setMap(map);
    }

    var sites = [
  ['Mount Evans', 39.58108, -105.63535, 4, 'This is Mount Evans.'],
  ['Irving Homestead', 40.315939, -105.440630, 2, 'This is the Irving Homestead.'],
  ['Badlands National Park', 43.785890, -101.90175, 1, 'This is Badlands National Park'],
  ['Flatirons in the Spring', 39.99948, -105.28370, 3, 'These are the Flatirons in the spring.']
];



    function setMarkers(map, markers) {

        for (var i = 0; i < markers.length; i++) {
            var sites = markers[i];
            var siteLatLng = new google.maps.LatLng(sites[1], sites[2]);
            var marker = new google.maps.Marker({
                position: siteLatLng,
                map: map,
                title: sites[0],
                zIndex: sites[3],
                html: sites[4]
            });

            var contentString = "Some content";

            google.maps.event.addListener(marker, "click", function () {
                alert(this.html);
                infowindow.setContent(this.html);
                infowindow.open(map, this);
            });
        }
    }
</script>


<% end %>

<% content_for :homepageHeader do %>
    
         <div class="row">
          <div class="col-md-8 col-md-offset-2">
            <h4 class="topBarText">
              Meet <span class="topBarTextHighlight">great people</span> over <span class="topBarTextHighlight">great food.</span>
            </h4>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 col-md-offset-3">
            <div class="topBarButtons">
              <a href="<%= user_omniauth_authorize_path(:facebook) %>" class="css3-button css3-button_blue facebookLoginButton">
                Sign up with 
                <%= image_tag("facebookLogo.png")%>
              </a>  
              <a href="<%= new_user_registration_path %>" class="css3-button css3-button_pink facebookLoginButton">
                Sign up with email
              </a>
            </div>
            
          </div>
        </div>
    

<% end %>

<div id="map_canvas" style="width: 100%; height: 300px;background: #ccc; border-bottom:4px solid #333;"></div>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <%= render 'layouts/messages' %>
        </div>
    </div>
</div>



<div class="filter">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div id="citySelect">
                  Select your city
                  <i class="icon-angle-down pull-right"></i>
                </div>

                <div id="cityList" class="hidden_div">
                  <div class="nano">
                  <div class="content"> 
                    <ul>
                      <li>
                        <strong>India</strong>
                        <ul>
                          <li>Ahmedabad</li>
                          <li>Bangalore</li>
                          <li>Hyderabad</li>
                          <li>Pune</li>
                        </ul>
                      </li>
                      <li>
                        <strong>Malaysia</strong>
                        <ul>
                          <li>Kuala Lumpur</li>
                          <li>Penang</li>
                          <li>Perak</li>
                          <li>Selangor</li>
                        </ul>
                      </li>
                    </ul>
                  </div>
                  
                  </div>
                </div>
                
            </div>
        </div>
    </div>
</div>



<div class="container">
    <div class="row-fluid">
        <div class="span12">
            <%# Adding the city name to the title i.e. the page title should read city name events eg. Hyderabad events %>
            
            <% if session[:city].nil? %>
                <% session[:city] = "" %>
            <% end %>

            
            <% if session[:city].empty? %>
                <h1>Events</h1>    
            <% else %>
                <h1><%= session[:city] %> Events</h1>
            <% end %>   
            
        </div>
    </div>
</div>

<%= render partial: 'events/event_list',  :locals => {:events => @events} %>

<script>
  $(".nano").nanoScroller();
</script>

<script>
  $(document).ready(function(){
    $(document).mouseup(function (e)
    {
        var container = $("#cityList");
        if (container.has(e.target).length === 0)
        {
          container.addClass('hidden_div');
        }
      });
    
    $('#citySelect').click(function(){
      $('#cityList').removeClass('hidden_div');
      $('#cityList .content ul ul li').click(function(e){
        var citySelected = $(this).text();
        var url = window.location.pathname
        var url_to_submit_to = '/'+citySelected;
        window.location = url_to_submit_to;
      });
    });
  });
</script>