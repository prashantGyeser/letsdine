<% content_for :javascript do %>
    <%= javascript_include_tag "closed-event-overlay" %>
    <%= javascript_include_tag "cycle" %>
<% end %>

<div class="subHeader">
    <div class="container">
        <div class="row-fluid">
            <div id="slider">
                <div id="firstSlider" class="slide">
                    <div class="span4">
                        <div class="subHeaderImages">
                            <%= image_tag "poloroid.png", :class => "firstSubHeaderImage" %>
                        </div>
                    </div>

                    <div class="span8">
                        <h1>Private celebrations</h1>
                        <p>
                            Confused on what to do for your birthday? Or still worried on what to do for your anniversary? 
                        </p>
                        <p>
                            Bid adieu to all your worries!
                        </p>
                        <p>
                            Whether you're celebrating a special occasion or hosting a private dinner to catch up with friends; click right here to have a great experience!
                        </p>
                        <p class="bottomMargin">
                            LetsDine provides specially crafted menus at the choicest of restaurants in Hyderabad to help you have a memorable day! Just choose your restaurant, invite your friends and family and sit back! While we make this moment special for you.
                        </p>

                        <%= link_to 'Create a private celebration', new_event_path, :class => "css3button topMargin" %> 
                    </div>
                </div>

                <!-- Second slider -->
                <div id="secondSlider" class="slide">
                    <div class="span4">
                        <div class="subHeaderImages">
                            <%= image_tag "community-dining.png", :class => "firstSubHeaderImage" %>
                        </div>
                    </div>

                    <div class="span8">
                        <h1>Community events</h1>
                        <p>
                            Would you like to make new friends in your city?
                        </p>
                        <p>
                            Meet, interact and become friends with other like-minded people in your city. Join in at one of our themed dining events; to have a great time! 
                        </p>
                        <p class="bottomMargin">
                            Book your seat at the event of your choice, and start living an entirely new experience! Be part of a 'real world' community!
                        </p>

                        <a href="#communityEventsHeader" class="css3button topMargin">See all the community events</a>
                    </div>
                </div>

            </div>
            
            

        </div>
    </div>
</div>


<div class="row-fluid">
    <div class="span12">
        <%= render 'layouts/messages' %>
    </div>
</div>

<div class="container">
    <div class="row-fluid">
        <div class="span12">
            <h1 id="communityEventsHeader">Community events</h1>
        </div>
    </div>
</div>

<div class="container">
    <div class="row-fluid">

        <div class="span12">
            <p>
                Meet, interact and network with wonderful people from your city. All this while you enjoy great food!
            </p>
        </div>
        
        

    </div>
</div>


<div class="content">
        <div class="container">
            <% eventCount = 0 %>
            <% @events.each do |event| %>
                <% restaurant = event.restaurant %>

                <% if ( eventCount%4 ) == 0 %>
                    <div class="row-fluid">  
                <% end %>

                <div class="span3">
                    
                    <%# Todo: Right now I have setup the special field in the event table as a string value. This needs to be changed to a boolean. Right now using a boolean value seems to ruby interpret the values incorrectly when they are coming in the params. Need to figure out why this is happening and fix it. %>
                    <% if event.special == "true" %>
                        <div class="event_special">
                    <% else %>
                        <div class="event white_background">    
                    <% end %>

                        <% if event.event_image.blank? %>
                            <%= image_tag restaurant.photo_url(:large_scaled).to_s %>
                        <% else %>
                            <%= image_tag event.event_image_url(:large_scaled).to_s %>
                        <% end %>

                        <% if event.status == 'closed' || event.status == "full" %>
                            <div class="closed">
                                <% if event.status == "full" %>
                                    <h3>Full</h3>
                                <% else %>
                                    <h3>Closed</h3>    
                                <% end %>
                            </div>    
                        <% end %>
                        
                        <h4><%= link_to event.event_name, event_path(event) %></h4>
                        <div class="seats_left_event_page">
                            <% seats_left = event.max_seats - event.attendee.pluck(:seats).sum %>
                            <%= seats_left %> Seats left
                        </div>
                        <div class="eventDetails">
                            <div class="detail">
                                <img src="/assets/locationIcon.png">
                                <%= restaurant.name %>
                            </div>

                            <div class="detail">
                                <img src="/assets/timeIcon.png">
                                <%= event.event_date.strftime("%d %B %Y") %>
                                <%= event.event_time.strftime("%I:%M%p") %>
                            </div>
                        </div>
                        <p>
                            <%= truncate(event.event_description, :length => 100) %> <%= link_to "See event", event_path(event) %>
                        </p>
                        <div class="peopleAttending">
                            <% event.attendee.first(4).each do |attendee| %>
                                <% if attendee.user.image.blank? %>
                                    <%= image_tag "/assets/noProfilePic.png", "data-toggle" => "tooltip", :title => attendee.user.name, :class => "profilePic" %>    
                                <% else %>
                                    <%= image_tag attendee.user.image.to_s, "data-toggle" => "tooltip", :title => attendee.user.name, :class => "profilePic" %>    
                                <% end %>

                            <% end %>
                            <p>
                                <%= link_to "See All People Attending", event_path(event) %>
                            </p>
                        </div>
                    </div>
                </div>    

                <% if ( eventCount%3 ) == 0 && eventCount != 0%>
                    </div>        
                    <% eventCount = 0 %>
                <% else %>
                    <% eventCount = eventCount + 1 %>
                <% end %>                
                <%# Closing tag for the new row div %>
                
            <% end %>
        </div>
    </div>   



<div id="communication" class="modal hide fade">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>No events in your city</h3>
  </div>
  <div class="modal-body">

    <p>There are no events in your city right now. Leave your email address and we will get back to you once we start conducting events in your city</p>
    
    <%= form_for(@new_city_notification, :remote => true) do |f| %>
        <% if  request.location.nil? %>
            
        <% else %>
            <div class="field">
                <%= f.hidden_field :city, :value => request.location.city %>
            </div>    
        <% end %>
        <div class="field">
            <%= f.label :email %>
            <%= f.text_field :email, :placeholder => "Enter your email address" %>
        </div>    

  </div>
  <div class="modal-footer">
    <%= f.submit "Keep me informed", :class => "large awesome green", :id => "keep_me_informed"  %>
  </div>
  <% end %>
</div>

<!-- Slider script -->
<script>
$(document).ready(function(){
    //$('#firstSlider').delay(1000).fadeOut();
    $('#slider').cycle();
})
</script>


<% if @no_events_in_city == true %>
    <script>
    $(document).ready(function(){
      $('#communication').modal('show');
      $('#keep_me_informed').click(function(event) {
        var valuesToSubmit = $('#new_new_city_notification').serialize();
        $.ajax({
          url: $('#new_new_city_notification').attr('action'),
          data: valuesToSubmit,
          type: "POST",
          dataType: "JSON"
        }).success(function(json){
            $('#communication').modal('hide');
        });
        return false;
      });
    });
  </script>  
<% end %>
            
