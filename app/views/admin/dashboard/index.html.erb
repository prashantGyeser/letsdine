<script type="text/javascript">
$(function () {
        $('#container').highcharts({
            chart: {
                type: 'area',
            },
            title: {
                text: ''
            },
            xAxis: {
                type: 'datetime',
            },
            yAxis: {
                title: {
                    text: ''
                }
            },
            tooltip: {
                borderColor: "#fff",
                backgroundColor: "rgba(255,255,255,1)",
                pointFormat: '{series.name}: <b>{point.y:,.0f}</b> joined'
            },
            plotOptions: {
                area: {
                    marker: {
                        enabled: false,
                        symbol: 'circle',
                        radius: 2,
                        states: {
                            hover: {
                                enabled: true
                            }
                        }
                    }
                }
            },
            series: [{
                name: 'Signups',
                color: '#dd4124',
                fillColor: 'rgba(221,65,36,.2)',
                pointInterval: <%= 1.day * 1000 %>,
                pointStart: <%= 4.weeks.ago.to_i * 1000 %>,
                data: <%= (4.weeks.ago.to_date..Date.today).map {|date| User.total_signups_on(date).to_i}.inspect %>
            },
            {
                name: 'Attendees',
                color: '#83ca21',
                fillColor: 'rgba(131,202,33,.2)',
                pointInterval: <%= 1.day * 1000 %>,
                pointStart: <%= 4.weeks.ago.to_i * 1000 %>,
                data: <%= (4.weeks.ago.to_date..Date.today).map {|date| Attendee.total_joins_on(date).to_i}.inspect %>
            },
            ]
        });
    });
    

        </script>

<div class="container">
    <div class="row-fluid">
        <div class="span12">
            <h1>Sign ups</h1>
            <div id="container" style="min-width: 100%; height: 400px; margin: 0 auto"></div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row-fluid">
        <div class="span12">
            <h1>Stats</h1>
        </div>
    </div>
</div>

<div class="container">
    <div class="row-fluid">
        <div class="span3 key_stat green">
            <%= User.total_signups_this_month %> Sign ups this month
        </div>
        <div class="span3 key_stat red">
            <%= Attendee.total_attendees_this_month %> attendees this month
        </div>
        <div class="span3 key_stat red">
            <%= Event.total_events_this_month%> events this month
        </div>
        <div class="span3 key_stat green">
            Revenue this month
        </div>
    </div>
</div>

<div class="container">
    <div class="row-fluid">
        <div class="span12">
            <h1>Events</h1>
            
        </div>
    </div>
</div>

<div class="container">
    <div class="row-fluid">
        <div class="span12">
            <ul class="event_list">
                <% @events.each do |event| %>
                    <li>
                        <div class="list-item-container">

                            <% if event.reminder == "sent" %>
                                <div class="notification_status green">
                                <i class="icon-ok"></i>    
                            <% else %>
                                <div class="notification_status grey">
                                <i class="icon-envelope-alt"></i>        
                            <% end %>
                                </div>

                            <div class="eventDetails">
                                <%= link_to event.event_name, event_path(event) %>
                                <% if event.event_type == 'private' %>
                                    <span class="red">Private</span>        
                                <% else %>
                                    <span class="green">Public</span>    
                                <% end %>
                            </div> 

                            <% if event.reminder == "sent"%>
                            <% else %>
                                <a href="<%= event.id %>" class="btn btn-large float-right send_notification">
                                    <%= image_tag "loader.gif"%>
                                    Send Notifications
                                </a>
                                

                            <% end %>

                        </div>  

                        <div class="event-details-list">
                            <% total_people_attending = 0%>
                            <% total_people_attending = event.attendee.all.count %>
                            <span><%= total_people_attending %> People Attending</span>
                            <span>Rs. <%= total_people_attending * Restaurant.find(event.restaurant_id).price%> Expected Earning</span>
                            <a href="#" class="btn btn-primary btn-small">View Attendees</a>
                        </div>
                    </li>                    
                <% end %>

            </ul>
        </div>
    </div>
</div>



<script>
    $(document).ready(function(){
        $('.send_notification').click(function(event){
            event.preventDefault();

            var host = window.location.host;
            var url_to_submit_to = host + "/admin/event/send_notification";

            var event_id = $(this).attr('href');
            var data_to_send = "event_id=" + event_id;

            $.ajax({
              url: "/admin/event/send_notification",
              type: 'PUT',
              data: data_to_send,
              success: function(data) {
                alert(data);
              },
              error: function(data) {
                alert("Somethuing went wrong");
              }

            });


        });
    })
</script>